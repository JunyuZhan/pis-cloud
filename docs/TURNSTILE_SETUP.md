# Cloudflare Turnstile é…ç½®æŒ‡å—

**æœ€åæ›´æ–°**: 2026-01-26

---

## ğŸ“‹ æ¦‚è¿°

Cloudflare Turnstile æ˜¯ä¸€ä¸ªå…è´¹çš„ã€éšç§å‹å¥½çš„éªŒè¯ç æœåŠ¡ï¼Œç”¨äºé˜²æ­¢æœºå™¨äººæ”»å‡»ã€‚æœ¬é¡¹ç›®ä½¿ç”¨ **Invisible æ¨¡å¼**ï¼Œç”¨æˆ·å®Œå…¨æ— æ„ŸçŸ¥ï¼Œä½“éªŒæœ€ä½³ã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åˆ›å»º Turnstile ç«™ç‚¹

1. è®¿é—® [Cloudflare Dashboard](https://dash.cloudflare.com/)
2. ç™»å½•ä½ çš„ Cloudflare è´¦å·ï¼ˆå¦‚æœæ²¡æœ‰è´¦å·ï¼Œå…è´¹æ³¨å†Œï¼‰
3. å¯¼èˆªåˆ° **Turnstile** â†’ **Add Site**
   - å¦‚æœæ‰¾ä¸åˆ°ï¼Œç›´æ¥è®¿é—®ï¼šhttps://dash.cloudflare.com/?to=/:account/turnstile
4. å¡«å†™ç«™ç‚¹ä¿¡æ¯ï¼š
   - **Site name**: ä½ çš„ç«™ç‚¹åç§°ï¼ˆå¦‚ "PIS Admin Login"ï¼‰
   - **Domain**: ä½ çš„åŸŸåï¼ˆå¦‚ `yourdomain.com`ï¼‰
     - æœ¬åœ°å¼€å‘å¯ä»¥å¡«å†™ï¼š`localhost` æˆ– `127.0.0.1`
   - **Widget Mode**: é€‰æ‹© **Invisible**ï¼ˆæ¨èï¼‰æˆ– **Managed**
5. ç‚¹å‡» **Create**
6. è·å–ä¸¤ä¸ªå¯†é’¥ï¼š
   - **Site Key**ï¼ˆå…¬å¼€å¯†é’¥ï¼Œç”¨äºå‰ç«¯ï¼‰- åœ¨ç«™ç‚¹è¯¦æƒ…é¡µé¢é¡¶éƒ¨ï¼Œç›´æ¥å¤åˆ¶
   - **Secret Key**ï¼ˆç§å¯†å¯†é’¥ï¼Œç”¨äºåç«¯éªŒè¯ï¼‰- ç‚¹å‡» "Reveal" æˆ– "æ˜¾ç¤º" æŒ‰é’®æ˜¾ç¤ºåå¤åˆ¶
   
**æç¤º**ï¼šå¦‚æœæ‰¾ä¸åˆ° Turnstile é€‰é¡¹ï¼Œç›´æ¥è®¿é—®ï¼šhttps://dash.cloudflare.com/?to=/:account/turnstile

### 2. é…ç½®ç¯å¢ƒå˜é‡

åœ¨ `.env.local` æ–‡ä»¶ä¸­æ·»åŠ ï¼š

```bash
# Cloudflare Turnstile (å¯é€‰)
NEXT_PUBLIC_TURNSTILE_SITE_KEY=your-site-key-here
TURNSTILE_SECRET_KEY=your-secret-key-here
```

### 3. é‡å¯å¼€å‘æœåŠ¡å™¨

```bash
pnpm dev
```

---

## âœ… éªŒè¯é…ç½®

### æ£€æŸ¥å‰ç«¯

1. è®¿é—®ç™»å½•é¡µé¢ï¼š`http://localhost:3000/admin/login`
2. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· â†’ Network
3. æŸ¥çœ‹æ˜¯å¦æœ‰è¯·æ±‚åˆ° `challenges.cloudflare.com`
4. å¦‚æœçœ‹åˆ°è¯·æ±‚ï¼Œè¯´æ˜ Turnstile å·²åŠ è½½

### æ£€æŸ¥åç«¯

1. å°è¯•ç™»å½•
2. æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—ï¼Œåº”è¯¥çœ‹åˆ° Turnstile éªŒè¯è¯·æ±‚
3. å¦‚æœéªŒè¯å¤±è´¥ï¼Œä¼šè¿”å›é”™è¯¯ä¿¡æ¯

---

## ğŸ”§ å·¥ä½œåŸç†

### Invisible æ¨¡å¼æµç¨‹

1. **é¡µé¢åŠ è½½**ï¼šTurnstile è„šæœ¬è‡ªåŠ¨åŠ è½½
2. **åå°éªŒè¯**ï¼šTurnstile åœ¨åå°åˆ†æç”¨æˆ·è¡Œä¸º
3. **è‡ªåŠ¨æ‰§è¡Œ**ï¼šå¦‚æœåˆ¤æ–­ä¸ºæ­£å¸¸ç”¨æˆ·ï¼Œè‡ªåŠ¨ç”Ÿæˆ token
4. **æäº¤è¡¨å•**ï¼štoken éšç™»å½•è¯·æ±‚ä¸€èµ·å‘é€
5. **æœåŠ¡ç«¯éªŒè¯**ï¼šåç«¯è°ƒç”¨ Cloudflare API éªŒè¯ token

### ç”¨æˆ·ä½“éªŒ

- âœ… **å®Œå…¨æ— æ„ŸçŸ¥**ï¼šç”¨æˆ·çœ‹ä¸åˆ°ä»»ä½•éªŒè¯ç•Œé¢
- âœ… **æ— éœ€æ“ä½œ**ï¼šä¸éœ€è¦ç‚¹å‡»ã€æ»‘åŠ¨æˆ–è¾“å…¥
- âœ… **è‡ªåŠ¨éªŒè¯**ï¼šé¡µé¢åŠ è½½æ—¶è‡ªåŠ¨å®Œæˆ

---

## ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

### å·²å®æ–½çš„å®‰å…¨æªæ–½

1. **æœåŠ¡ç«¯éªŒè¯**ï¼štoken å¿…é¡»åœ¨æœåŠ¡ç«¯éªŒè¯ï¼Œå®¢æˆ·ç«¯æ— æ³•ä¼ªé€ 
2. **IP éªŒè¯**ï¼šéªŒè¯æ—¶åŒ…å«ç”¨æˆ· IPï¼Œé˜²æ­¢ token é‡ç”¨
3. **é™çº§ç­–ç•¥**ï¼šå¦‚æœ Turnstile æœåŠ¡ä¸å¯ç”¨ï¼Œä»ç„¶å…è®¸ç™»å½•ï¼ˆé€‚åˆç§æœ‰ç³»ç»Ÿï¼‰

### éªŒè¯æµç¨‹

```typescript
// 1. å‰ç«¯è·å– tokenï¼ˆè‡ªåŠ¨ï¼‰
Turnstile â†’ ç”Ÿæˆ token

// 2. æäº¤ç™»å½•è¯·æ±‚
POST /api/auth/login
{
  email: "...",
  password: "...",
  turnstileToken: "token-from-turnstile"
}

// 3. æœåŠ¡ç«¯éªŒè¯ token
POST https://challenges.cloudflare.com/turnstile/v0/siteverify
{
  secret: "your-secret-key",
  response: "token-from-client",
  remoteip: "user-ip"
}

// 4. éªŒè¯é€šè¿‡ï¼Œç»§ç»­ç™»å½•æµç¨‹
```

---

## âš™ï¸ é…ç½®é€‰é¡¹

### Widget æ¨¡å¼

| æ¨¡å¼ | è¯´æ˜ | ç”¨æˆ·ä½“éªŒ |
|------|------|---------|
| **Invisible** | å®Œå…¨éšè—ï¼Œè‡ªåŠ¨éªŒè¯ | â­â­â­â­â­ æœ€ä½³ |
| **Managed** | Cloudflare è‡ªåŠ¨åˆ¤æ–­æ˜¯å¦éœ€è¦äº¤äº’ | â­â­â­â­ è‰¯å¥½ |
| **Non-Interactive** | æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨ | â­â­â­ ä¸€èˆ¬ |

**æ¨è**ï¼šä½¿ç”¨ **Invisible** æ¨¡å¼ï¼ˆå½“å‰å®ç°ï¼‰

### ä¸»é¢˜è®¾ç½®

- `auto`: è‡ªåŠ¨é€‚åº”ç³»ç»Ÿä¸»é¢˜ï¼ˆå½“å‰è®¾ç½®ï¼‰
- `light`: æµ…è‰²ä¸»é¢˜
- `dark`: æ·±è‰²ä¸»é¢˜

---

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜ï¼šTurnstile æœªåŠ è½½

**å¯èƒ½åŸå› **ï¼š
1. ç¯å¢ƒå˜é‡æœªè®¾ç½®
2. Site Key é…ç½®é”™è¯¯
3. ç½‘ç»œé—®é¢˜ï¼ˆæ— æ³•è®¿é—® Cloudflareï¼‰

**è§£å†³æ–¹æ³•**ï¼š
1. æ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®è®¾ç½®
2. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯
3. ç¡®è®¤ç½‘ç»œå¯ä»¥è®¿é—® `challenges.cloudflare.com`

### é—®é¢˜ï¼šéªŒè¯æ€»æ˜¯å¤±è´¥

**å¯èƒ½åŸå› **ï¼š
1. Secret Key é…ç½®é”™è¯¯
2. Domain é…ç½®ä¸åŒ¹é…
3. Token å·²è¿‡æœŸï¼ˆæœ‰æ•ˆæœŸ 5 åˆ†é’Ÿï¼‰

**è§£å†³æ–¹æ³•**ï¼š
1. æ£€æŸ¥ Secret Key æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤ Cloudflare Dashboard ä¸­é…ç½®çš„åŸŸååŒ¹é…
3. åˆ·æ–°é¡µé¢é‡æ–°è·å– token

### é—®é¢˜ï¼šç™»å½•è¢«é˜»æ­¢

**å¯èƒ½åŸå› **ï¼š
1. Turnstile éªŒè¯å¤±è´¥
2. Token éªŒè¯è¶…æ—¶

**è§£å†³æ–¹æ³•**ï¼š
1. åˆ·æ–°é¡µé¢é‡æ–°éªŒè¯
2. æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—æŸ¥çœ‹è¯¦ç»†é”™è¯¯
3. å¦‚æœæŒç»­å¤±è´¥ï¼Œå¯ä»¥æš‚æ—¶ç¦ç”¨ Turnstileï¼ˆç§»é™¤ç¯å¢ƒå˜é‡ï¼‰

---

## ğŸ”„ é™çº§ç­–ç•¥

å¦‚æœ Turnstile æœåŠ¡ä¸å¯ç”¨æˆ–æœªé…ç½®ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨é™çº§ï¼š

- âœ… **æœªé…ç½® Turnstile**ï¼šç™»å½•åŠŸèƒ½æ­£å¸¸å·¥ä½œï¼Œè·³è¿‡éªŒè¯
- âœ… **Turnstile åŠ è½½å¤±è´¥**ï¼šå…è®¸ç™»å½•ï¼Œè®°å½•è­¦å‘Šæ—¥å¿—
- âœ… **éªŒè¯æœåŠ¡ä¸å¯ç”¨**ï¼šå…è®¸ç™»å½•ï¼ˆé€‚åˆç§æœ‰ç³»ç»Ÿï¼‰

è¿™ç¡®ä¿äº†å³ä½¿ Turnstile å‡ºç°é—®é¢˜ï¼Œç®¡ç†å‘˜ä»ç„¶å¯ä»¥ç™»å½•ã€‚

---

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### æ—¥å¿—è®°å½•

ç™»å½• API ä¼šè®°å½• Turnstile éªŒè¯ç»“æœï¼š

```json
{
  "type": "turnstile_verification",
  "success": true,
  "ip": "1.2.3.4",
  "timestamp": "2026-01-26T10:00:00Z"
}
```

### ç›‘æ§å»ºè®®

- ç›‘æ§ Turnstile éªŒè¯å¤±è´¥ç‡
- ç›‘æ§å¼‚å¸¸éªŒè¯æ¨¡å¼ï¼ˆå¯èƒ½è¡¨ç¤ºæ”»å‡»ï¼‰
- è®°å½•éªŒè¯å“åº”æ—¶é—´

---

## ğŸ’¡ æœ€ä½³å®è·µ

1. **ä½¿ç”¨ Invisible æ¨¡å¼**ï¼šæœ€ä½³ç”¨æˆ·ä½“éªŒ
2. **é…ç½®æ­£ç¡®çš„åŸŸå**ï¼šç¡®ä¿ Cloudflare Dashboard ä¸­çš„åŸŸååŒ¹é…
3. **å®šæœŸæ£€æŸ¥æ—¥å¿—**ï¼šç›‘æ§éªŒè¯å¤±è´¥æƒ…å†µ
4. **æµ‹è¯•é™çº§ç­–ç•¥**ï¼šç¡®ä¿ Turnstile ä¸å¯ç”¨æ—¶ç³»ç»Ÿä»å¯ç”¨

---

## ğŸ“š å‚è€ƒèµ„æº

- [Cloudflare Turnstile æ–‡æ¡£](https://developers.cloudflare.com/turnstile/)
- [Turnstile Widget é…ç½®](https://developers.cloudflare.com/turnstile/concepts/widget/)
- [Turnstile éªŒè¯ API](https://developers.cloudflare.com/turnstile/get-started/server-side-validation/)

---

**æœ€åæ›´æ–°**: 2026-01-26
