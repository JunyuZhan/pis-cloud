# 相册海报功能说明

## 📖 什么是相册海报？

**相册海报** (`poster_image_url`) 是一个可选的相册配置字段，用于指定相册的展示海报图片。海报图片会在相册列表、详情页 Hero 区域和分享预览中优先显示，提供更专业和个性化的展示效果。

## 🎯 功能作用

### 1. **启动页（Splash Screen）** ⭐ 核心功能

当用户通过分享链接打开相册时，会首先显示一个**全屏启动页**：

#### 自定义启动页（设置了海报图片）
- 🎨 **全屏展示**：海报图片作为背景，全屏显示
- 📝 **相册信息**：显示相册标题和描述
- 📱 **移动端优化**：完美适配手机屏幕
- ✨ **优雅动画**：淡入淡出动画效果
- 👆 **交互提示**：显示"点击进入相册"提示
- ⏭️ **快速跳过**：右上角关闭按钮可快速跳过

#### 默认启动页（未设置海报图片）
- 🎨 **品牌展示**：显示网站 Logo、名称和描述
- 👤 **摄影师信息**：显示摄影师名称和标语
- 🎨 **渐变背景**：优雅的渐变背景设计
- 📱 **移动端优化**：完美适配手机屏幕
- ✨ **优雅动画**：淡入淡出动画效果
- 👆 **交互提示**：显示"点击进入相册"提示

**使用场景**：
- **自定义启动页**：活动宣传、展示活动主题和品牌形象
- **默认启动页**：品牌展示、提升网站专业度和品牌形象
- **第一印象**：给访客留下深刻的第一印象

### 2. **相册列表展示**

在首页和管理后台的相册列表中，海报图片会优先于封面照片显示：

```
优先级顺序：
1. 海报图片 (poster_image_url)
2. 封面照片 (cover_photo_id)
3. 默认占位图标
```

### 3. **相册详情页 Hero 区域**

相册详情页的顶部 Hero 区域会优先使用海报图片作为背景：

- 提供更专业的视觉展示
- 可以上传专门设计的宣传海报
- 提升相册的品牌形象

### 4. **分享预览（Open Graph/微信）**

分享到社交媒体时，海报图片会优先作为预览图：

```
优先级顺序：
1. 海报图片 (poster_image_url)
2. 分享图片 (share_image_url)
3. 封面照片 (cover_photo_id)
4. 默认应用图标
```

## 🔄 Fallback 机制

如果没有设置海报图片，系统会自动使用以下优先级：

1. **启动页**：
   - 设置了海报图片 → 显示自定义启动页（海报图片 + 相册信息）
   - 未设置海报图片 → 显示默认启动页（Logo + 网站信息 + 摄影师信息）
   - 已跳过（URL 参数） → 不显示启动页
2. **相册列表**：海报 → 封面照片 → 占位图标
3. **详情页 Hero**：海报 → 封面照片 → 渐变背景
4. **分享预览**：海报 → 分享图片 → 封面照片 → 默认图标

**重要**：
- 启动页**总是显示**（除非通过 URL 参数跳过），即使没有设置海报图片
- 默认启动页会展示网站品牌信息（Logo、名称、描述、摄影师信息）
- 设置海报图片后，启动页会使用海报图片作为背景，显示相册信息

## 📝 使用方法

### 设置启动页（海报图片）

**设置时机**：海报图片 URL 需要在**创建相册后**设置，因为创建时还没有上传照片。

**设置位置**：
1. 进入管理后台
2. 打开相册详情页（点击相册卡片）
3. 点击右上角**"设置"**按钮（⚙️ 图标）
4. 在设置页面中找到**"海报设置"**部分
5. 在**"相册海报图片 URL"**输入框中输入海报图片 URL（例如：`https://example.com/poster.jpg`）
6. 点击**"保存设置"**按钮

**设置后效果**：
- ✅ 分享链接打开时会显示全屏启动页
- ✅ 相册列表中使用海报图片作为封面
- ✅ 相册详情页 Hero 区域使用海报图片作为背景
- ✅ 分享到社交媒体时使用海报图片作为预览图

**注意事项**：
- 海报图片 URL 必须是公开可访问的 http/https 链接
- 建议图片尺寸：750x1334px（手机屏幕比例）
- 建议图片大小：小于 2MB，确保快速加载
- 如果留空，则使用封面照片，且不会显示启动页

#### 方法 2：使用动态海报生成

如果不想手动设置 URL，可以使用动态海报生成功能（见下方"动态海报生成"部分），系统会自动生成包含二维码的海报。

## 🎨 动态海报生成

除了静态海报图片，PIS 还支持**动态海报生成**功能，可以自动生成包含以下元素的海报：

### 海报内容

1. **背景图片**：使用 `poster_image_url` 或封面照片
2. **相册标题**：自动添加，支持自定义样式
3. **相册描述**：可选，自动换行
4. **二维码**：自动生成，包含相册链接
5. **提示文字**："扫描二维码查看相册"

### 使用方法

1. 打开相册详情页
2. 点击"分享"按钮
3. 切换到"二维码"标签页
4. 点击"生成海报"按钮
5. 在配置对话框中：
   - **快速选择模板**（推荐）：选择预设模板（经典、简约、优雅、商务）
   - **自定义样式**（可选）：
     - **布局样式**：居中、顶部、底部
     - **颜色**：标题颜色、描述颜色（十六进制格式）
     - **字体大小**：标题 32-72px（推荐 48-56px），描述 18-40px（推荐 24-30px）
     - **遮罩透明度**：20-80%（推荐 40-50%）
     - **二维码位置**：底部居中、左侧、右侧
     - **二维码大小**：200-400px（推荐 280px）
6. 点击"预览"查看效果
7. 点击"生成海报"下载 PNG 文件

### 预设模板

系统提供 4 种经过设计的预设模板，确保海报质量：

| 模板 | 特点 | 适用场景 |
|------|------|---------|
| **经典** | 居中布局，白色文字，适中遮罩 | 通用场景，适合大多数相册 |
| **简约** | 顶部布局，高对比度，小二维码 | 现代风格，简洁设计 |
| **优雅** | 底部布局，柔和色调，大字体 | 正式场合，高端展示 |
| **商务** | 居中布局，专业配色，标准尺寸 | 商务活动，企业宣传 |

**建议**：优先使用预设模板，然后根据需要进行微调。

### 海报规格

- **尺寸**：750x1334px（适合手机屏幕）
- **格式**：PNG
- **质量**：95%
- **文件命名**：`{相册标题}-海报.png`

## 🛡️ 质量保障

### 样式限制

为确保海报质量，系统对样式参数进行了合理限制：

- **字体大小限制**：
  - 标题：32-72px（推荐 48-56px）
  - 描述：18-40px（推荐 24-30px）
- **遮罩透明度限制**：20-80%（推荐 40-50%）
- **二维码大小限制**：200-400px（推荐 280px）
- **颜色格式验证**：必须是有效的十六进制颜色（#RRGGBB）

### 预设模板

系统提供 4 种预设模板，经过专业设计：

- **经典模板**：默认选择，适合大多数场景
- **简约模板**：现代风格，简洁设计
- **优雅模板**：正式场合，高端展示
- **商务模板**：商务活动，企业宣传

**优势**：
- ✅ 经过设计的样式组合
- ✅ 确保文字可读性
- ✅ 合理的视觉层次
- ✅ 一键应用，快速生成

### 自动验证

所有自定义样式都会经过自动验证和限制：

```typescript
// 自动限制字体大小
titleFontSize = Math.max(32, Math.min(72, titleFontSize))

// 自动限制遮罩透明度
overlayOpacity = Math.max(0.2, Math.min(0.8, overlayOpacity))

// 验证颜色格式
if (!/^#[0-9A-Fa-f]{6}$/.test(color)) {
  color = '#FFFFFF' // 使用默认值
}
```

## 🔒 安全特性

### URL 验证

海报图片 URL 会经过严格验证：

- ✅ 只允许 `http://` 和 `https://` 协议
- ✅ 禁止内网地址（SSRF 防护）
- ✅ URL 格式验证

### 验证规则

```typescript
// 协议检查
if (!['http:', 'https:'].includes(url.protocol)) {
  // 拒绝
}

// 内网地址检查
const isLocalhost = hostname === 'localhost' || hostname === '127.0.0.1'
const isPrivateIP = hostname.startsWith('192.168.') || ...
if (isLocalhost || isPrivateIP) {
  // 拒绝
}
```

## 💡 最佳实践

### 海报图片建议

1. **尺寸**：建议 750x1334px（手机屏幕比例）
2. **格式**：JPG 或 PNG
3. **大小**：建议小于 2MB，确保快速加载
4. **内容**：包含相册主题、活动信息、品牌元素

### 使用场景

- **活动宣传**：上传活动海报，提升品牌形象
- **专业展示**：使用精心设计的海报，展示专业水准
- **快速分享**：生成包含二维码的海报，方便线下分享

### 动态海报 vs 静态海报

| 特性 | 静态海报 | 动态海报 |
|------|---------|---------|
| 设置方式 | 输入 URL | 自动生成 |
| 包含内容 | 仅图片 | 图片+文字+二维码 |
| 自定义程度 | 低 | 高 |
| 使用场景 | 已有设计好的海报 | 快速生成分享海报 |

## 📝 代码实现

### 数据库字段

```sql
-- 添加海报图片URL字段
ALTER TABLE albums ADD COLUMN IF NOT EXISTS poster_image_url TEXT;

COMMENT ON COLUMN albums.poster_image_url IS 
'相册海报图片URL（用于列表展示、详情页Hero、分享预览，优先于封面照片）';
```

### 显示逻辑示例

```typescript
// 相册列表
const coverUrl = album.poster_image_url && album.poster_image_url.trim()
  ? album.poster_image_url.trim()
  : coverPhoto?.thumb_key 
    ? `${mediaUrl}/${coverPhoto.thumb_key}`
    : null

// 详情页 Hero
const coverUrl = album.poster_image_url && album.poster_image_url.trim()
  ? album.poster_image_url.trim()
  : coverPhoto?.preview_key 
    ? `${mediaUrl}/${coverPhoto.preview_key}`
    : null
```

## ❓ 常见问题

### Q: 海报图片和封面照片有什么区别？

**A**: 
- **封面照片**：从相册中的照片选择一张作为封面
- **海报图片**：专门设计的宣传图片，可以是外部 URL
- **优先级**：海报图片 > 封面照片

### Q: 如果没有设置海报会怎样？

**A**: 
- **启动页**：会显示默认启动页，包含网站 Logo、名称、描述和摄影师信息
- **相册列表和 Hero**：系统会自动使用封面照片，功能完全正常
- **海报是可选的增强功能**：设置海报图片后，启动页会使用海报图片作为背景，显示相册信息

### Q: 启动页可以跳过吗？

**A**: 可以。启动页支持以下方式跳过：
- 点击页面任意位置
- 点击右上角关闭按钮
- 刷新页面后不会再次显示（通过 URL 参数控制）

### Q: 海报图片必须上传到自己的服务器吗？

**A**: 不需要。可以使用任何公开的图片 URL（http/https），但必须通过安全验证（禁止内网地址）。

### Q: 动态海报生成需要什么？

**A**: 
- 浏览器支持 Canvas API
- 二维码已渲染（需要先打开二维码标签页）
- 可选：设置了海报图片或封面照片作为背景

### Q: 海报样式可以保存吗？

**A**: 目前海报样式配置是临时的，每次生成需要重新配置。但系统提供了 4 种预设模板（经典、简约、优雅、商务），可以快速应用。

### Q: 如何确保海报质量？

**A**: 
- **使用预设模板**：系统提供的模板经过专业设计，确保质量
- **遵循推荐值**：配置对话框会显示推荐值范围
- **预览功能**：生成前可以预览效果
- **自动限制**：系统会自动限制参数范围，防止极端值

### Q: 可以完全自定义样式吗？

**A**: 可以，但建议：
1. 先选择预设模板作为起点
2. 根据需要进行微调
3. 注意保持文字可读性（遮罩透明度、颜色对比度）
4. 使用预览功能检查效果

## 🔗 相关功能

- [分享图片 URL 说明](./SHARE_IMAGE_URL_EXPLANATION.md) - 分享预览图片配置
- [相册设置](./DEVELOPMENT.md) - 完整的相册配置说明
