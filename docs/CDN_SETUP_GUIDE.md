# CDN é…ç½®æŒ‡å—

> æ›´æ–°æ—¶é—´: 2026-01-26

## ðŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›è¯¦ç»†çš„ CDN é…ç½®æ­¥éª¤ï¼Œå¸®åŠ©ä½ å°†å›¾ç‰‡åª’ä½“æœåŠ¡å™¨æŽ¥å…¥ CDNï¼Œå¤§å¹…æå‡å›¾ç‰‡åŠ è½½é€Ÿåº¦ã€‚

---

## ðŸŽ¯ ä¸ºä»€ä¹ˆéœ€è¦ CDNï¼Ÿ

- **é€Ÿåº¦æå‡**: å‡å°‘å›¾ç‰‡åŠ è½½å»¶è¿Ÿ 50-70%
- **å…¨çƒåŠ é€Ÿ**: å°±è¿‘è®¿é—®ï¼Œå‡å°‘è·¨åŒºåŸŸå»¶è¿Ÿ
- **å¸¦å®½èŠ‚çœ**: é™ä½Žæºç«™å¸¦å®½åŽ‹åŠ›
- **æˆæœ¬ä¼˜åŒ–**: CDN æµé‡é€šå¸¸æ¯”æœåŠ¡å™¨å¸¦å®½æ›´ä¾¿å®œ

---

## ðŸš€ æ–¹æ¡ˆä¸€ï¼šCloudflare CDNï¼ˆæŽ¨èï¼Œå…è´¹ç‰ˆå¯ç”¨ï¼‰

### æ­¥éª¤ 1ï¼šæ³¨å†Œ Cloudflare è´¦å·

1. è®¿é—® https://dash.cloudflare.com
2. æ³¨å†Œè´¦å·ï¼ˆå…è´¹ç‰ˆå³å¯ï¼‰

### æ­¥éª¤ 2ï¼šæ·»åŠ åŸŸå

1. **ç™»å½• Cloudflare æŽ§åˆ¶å°**
2. **ç‚¹å‡» "Add a Site"**
3. **è¾“å…¥ä½ çš„åª’ä½“æœåŠ¡å™¨åŸŸå**ï¼ˆä¾‹å¦‚ï¼š`media.yourdomain.com`ï¼‰
4. **é€‰æ‹©å…è´¹è®¡åˆ’**ï¼ˆFree Planï¼‰
5. **ç­‰å¾… DNS æ‰«æå®Œæˆ**

### æ­¥éª¤ 3ï¼šé…ç½® DNS è®°å½•

1. **æ·»åŠ  A è®°å½•**ï¼ˆå¦‚æžœä½¿ç”¨ IP åœ°å€ï¼‰
   ```
   ç±»åž‹: A
   åç§°: mediaï¼ˆæˆ– @ï¼‰
   å†…å®¹: ä½ çš„æœåŠ¡å™¨ IP åœ°å€
   TTL: Autoï¼ˆè‡ªåŠ¨ï¼‰
   ä»£ç†çŠ¶æ€: ðŸŸ  Proxiedï¼ˆå¼€å¯ä»£ç†ï¼Œå¯ç”¨ CDNï¼‰
   ```

2. **æˆ–æ·»åŠ  CNAME è®°å½•**ï¼ˆå¦‚æžœä½¿ç”¨åŸŸåï¼‰
   ```
   ç±»åž‹: CNAME
   åç§°: media
   ç›®æ ‡: ä½ çš„æºç«™åŸŸå
   TTL: Auto
   ä»£ç†çŠ¶æ€: ðŸŸ  Proxied
   ```

### æ­¥éª¤ 4ï¼šé…ç½®ç¼“å­˜è§„åˆ™ï¼ˆé‡è¦ï¼‰

#### æ–¹æ³• Aï¼šä½¿ç”¨ Cache Rulesï¼ˆæŽ¨èï¼Œå…è´¹ç‰ˆå¯ç”¨ï¼‰

**ä¼˜åŠ¿**ï¼š
- âœ… å…è´¹ç‰ˆå¯ç”¨
- âœ… å¯ä»¥è®¾ç½® 1 å¹´ç¼“å­˜ï¼ˆæ¯” Page Rules æ›´é•¿ï¼‰
- âœ… æ›´çµæ´»çš„åŒ¹é…è§„åˆ™

**é…ç½®æ­¥éª¤**ï¼š

1. **è¿›å…¥ "Rules" -> "Cache Rules"**ï¼ˆä¸æ˜¯ Page Rulesï¼‰
2. **åˆ›å»ºè§„åˆ™ 1ï¼šç¼©ç•¥å›¾ç¼“å­˜**
   - ç‚¹å‡» "Create rule"
   - **è§„åˆ™åç§°**: `å›¾ç‰‡ç¼©ç•¥å›¾é•¿æœŸç¼“å­˜`
   - **ä½¿ç”¨è¡¨è¾¾å¼ç”Ÿæˆå™¨**ï¼ˆä¸è¦ä½¿ç”¨è‡ªå®šä¹‰è¡¨è¾¾å¼ï¼‰ï¼š
     - æ¡ä»¶ 1ï¼šHostname equals `media.yourdomain.com`
     - æ¡ä»¶ 2ï¼šPath starts with `/pis-photos/processed/thumbs/`
     - é€»è¾‘ï¼šAND
   - **è®¾ç½®**ï¼š
     - ç¼“å­˜èµ„æ ¼ï¼šç¬¦åˆç¼“å­˜æ¡ä»¶ï¼ˆEligible for Cacheï¼‰
     - è¾¹ç¼˜ TTLï¼š31536000 ç§’ï¼ˆ1å¹´ï¼‰
     - æµè§ˆå™¨ TTLï¼š31536000 ç§’ï¼ˆ1å¹´ï¼‰

3. **åˆ›å»ºè§„åˆ™ 2ï¼šé¢„è§ˆå›¾ç¼“å­˜**
   - **è§„åˆ™åç§°**: `å›¾ç‰‡é¢„è§ˆå›¾é•¿æœŸç¼“å­˜`
   - **è¡¨è¾¾å¼ç”Ÿæˆå™¨**ï¼š
     - Hostname equals `media.yourdomain.com`
     - AND Path starts with `/pis-photos/processed/previews/`
   - **è®¾ç½®**ï¼šåŒè§„åˆ™ 1

4. **åˆ›å»ºè§„åˆ™ 3ï¼šå…œåº•è§„åˆ™**
   - **è§„åˆ™åç§°**: `æ‰€æœ‰å¤„ç†åŽå›¾ç‰‡ç¼“å­˜`
   - **è¡¨è¾¾å¼ç”Ÿæˆå™¨**ï¼š
     - Hostname equals `media.yourdomain.com`
     - AND Path starts with `/pis-photos/processed/`
   - **è®¾ç½®**ï¼š
     - ç¼“å­˜èµ„æ ¼ï¼šç¬¦åˆç¼“å­˜æ¡ä»¶
     - è¾¹ç¼˜ TTLï¼š2592000 ç§’ï¼ˆ1ä¸ªæœˆï¼‰
     - æµè§ˆå™¨ TTLï¼šå°Šé‡çŽ°æœ‰æ ‡å¤´ï¼ˆRespect Existing Headersï¼‰

**âš ï¸ é‡è¦æç¤º**ï¼š
- å…è´¹ç‰ˆç”¨æˆ·**å¿…é¡»ä½¿ç”¨è¡¨è¾¾å¼ç”Ÿæˆå™¨**ï¼Œä¸è¦ä½¿ç”¨è‡ªå®šä¹‰è¡¨è¾¾å¼
- `matches` æ“ä½œç¬¦éœ€è¦ Business è®¡åˆ’ï¼Œä½†è¡¨è¾¾å¼ç”Ÿæˆå™¨ä¸­çš„ `starts with` æ˜¯å…è´¹çš„
- è§„åˆ™é¡ºåºå¾ˆé‡è¦ï¼šæ›´å…·ä½“çš„è§„åˆ™åº”è¯¥æ”¾åœ¨å‰é¢

#### æ–¹æ³• Bï¼šä½¿ç”¨ Page Rulesï¼ˆå¤‡é€‰ï¼‰

å¦‚æžœä¸æƒ³ä½¿ç”¨ Cache Rulesï¼Œå¯ä»¥ä½¿ç”¨ Page Rulesï¼š

1. **è¿›å…¥ "Rules" -> "Page Rules"**
2. **åˆ›å»ºè§„åˆ™**ï¼š
   ```
   URL Pattern: media.yourdomain.com/pis-photos/processed/thumbs/*
   è®¾ç½®:
   - Cache Level: Cache Everything
   - Edge Cache TTL: 1 monthï¼ˆå…è´¹ç‰ˆæœ€é•¿ï¼‰
   - Browser Cache TTL: 1 year
   ```

**é™åˆ¶**ï¼šå…è´¹ç‰ˆ Page Rules çš„ Edge Cache TTL æœ€é•¿åªæœ‰ 1 ä¸ªæœˆã€‚

### æ­¥éª¤ 5ï¼šé…ç½®æ€§èƒ½ä¼˜åŒ–

1. **è¿›å…¥ "Speed" -> "Optimization"**
2. **å¯ç”¨ä»¥ä¸‹é€‰é¡¹**ï¼š
   - âœ… Auto Minify: CSS, JavaScript, HTML
   - âœ… Brotliï¼ˆåŽ‹ç¼©ï¼‰
   - âœ… HTTP/2
   - âœ… HTTP/3 (with QUIC)

3. **è¿›å…¥ "Network"**
   - å¯ç”¨ HTTP/3 (with QUIC)

### æ­¥éª¤ 6ï¼šé…ç½® SSL/TLS

1. **è¿›å…¥ "SSL/TLS"**
2. **Overview è®¾ç½®**:
   - é€‰æ‹© "Full"ï¼ˆå¦‚æžœæºç«™æ˜¯ HTTPï¼‰
   - æˆ– "Full (strict)"ï¼ˆå¦‚æžœæºç«™æ˜¯ HTTPSï¼‰

3. **Edge Certificates**:
   - å¯ç”¨ "Always Use HTTPS"
   - å¯ç”¨ "Automatic HTTPS Rewrites"

### æ­¥éª¤ 7ï¼šæ›´æ–°çŽ¯å¢ƒå˜é‡

```bash
# apps/web/.env.local
NEXT_PUBLIC_MEDIA_URL=https://media.yourdomain.com/pis-photos
```

### æ­¥éª¤ 8ï¼šéªŒè¯é…ç½®

```bash
# æ£€æŸ¥ CDN æ˜¯å¦ç”Ÿæ•ˆ
curl -I https://media.yourdomain.com/pis-photos/processed/thumbs/test.jpg

# åº”è¯¥çœ‹åˆ° Cloudflare å“åº”å¤´ï¼š
# CF-Cache-Status: HITï¼ˆç¼“å­˜å‘½ä¸­ï¼‰æˆ– MISSï¼ˆé¦–æ¬¡è®¿é—®ï¼‰
# CF-Ray: xxxxx-XXXï¼ˆCloudflare èŠ‚ç‚¹æ ‡è¯†ï¼‰
# Server: cloudflare
```

---

## ðŸŒ æ–¹æ¡ˆäºŒï¼šé˜¿é‡Œäº‘ CDN

### æ­¥éª¤ 1ï¼šå¼€é€š CDN æœåŠ¡

1. ç™»å½•é˜¿é‡Œäº‘æŽ§åˆ¶å°
2. æœç´¢ "CDN"
3. å¼€é€š CDN æœåŠ¡

### æ­¥éª¤ 2ï¼šæ·»åŠ åŠ é€ŸåŸŸå

1. **è¿›å…¥ CDN æŽ§åˆ¶å°**
2. **ç‚¹å‡» "æ·»åŠ åŸŸå"**
3. **å¡«å†™åŸŸåä¿¡æ¯**ï¼š
   ```
   åŠ é€ŸåŸŸå: media.yourdomain.com
   ä¸šåŠ¡ç±»åž‹: å›¾ç‰‡å°æ–‡ä»¶
   æºç«™ä¿¡æ¯: 
     - ç±»åž‹: æºç«™åŸŸåï¼ˆæˆ– IPï¼‰
     - åœ°å€: ä½ çš„æºç«™åœ°å€
   ```

### æ­¥éª¤ 3ï¼šé…ç½®ç¼“å­˜è§„åˆ™

1. **è¿›å…¥ "ç¼“å­˜é…ç½®"**
2. **æ·»åŠ ç¼“å­˜è§„åˆ™**ï¼š
   ```
   è§„åˆ™åç§°: å›¾ç‰‡é•¿æœŸç¼“å­˜
   è·¯å¾„: /pis-photos/processed/*
   ç¼“å­˜æ—¶é—´: 31536000 ç§’ï¼ˆ1å¹´ï¼‰
   å¿½ç•¥å‚æ•°: å¦ï¼ˆä¿ç•™æŸ¥è¯¢å‚æ•°ï¼‰
   ```

### æ­¥éª¤ 4ï¼šé…ç½® HTTPS

1. **è¿›å…¥ "HTTPSé…ç½®"**
2. **ä¸Šä¼  SSL è¯ä¹¦**ï¼ˆæˆ–ä½¿ç”¨é˜¿é‡Œäº‘å…è´¹è¯ä¹¦ï¼‰
3. **å¯ç”¨ HTTPS**

### æ­¥éª¤ 5ï¼šé…ç½®å›žæº

1. **è¿›å…¥ "å›žæºé…ç½®"**
2. **è®¾ç½®å›žæº Host**: `media.yourdomain.com`
3. **å›žæºåè®®**: HTTP/HTTPSï¼ˆæ ¹æ®æºç«™ï¼‰

---

## ðŸ‡¨ðŸ‡³ æ–¹æ¡ˆä¸‰ï¼šè…¾è®¯äº‘ CDN

### æ­¥éª¤ 1ï¼šå¼€é€š CDN

1. ç™»å½•è…¾è®¯äº‘æŽ§åˆ¶å°
2. æœç´¢ "CDN"
3. å¼€é€šæœåŠ¡

### æ­¥éª¤ 2ï¼šæ·»åŠ åŸŸå

1. **è¿›å…¥ CDN æŽ§åˆ¶å°**
2. **ç‚¹å‡» "åŸŸåç®¡ç†" -> "æ·»åŠ åŸŸå"**
3. **å¡«å†™ä¿¡æ¯**ï¼š
   ```
   åŠ é€ŸåŸŸå: media.yourdomain.com
   åŠ é€ŸåŒºåŸŸ: ä¸­å›½å¢ƒå†…ï¼ˆæˆ–å…¨çƒï¼‰
   æºç«™é…ç½®:
     - ç±»åž‹: æºç«™åŸŸå
     - åœ°å€: ä½ çš„æºç«™åœ°å€
   ```

### æ­¥éª¤ 3ï¼šé…ç½®ç¼“å­˜

1. **è¿›å…¥ "ç¼“å­˜é…ç½®"**
2. **æ·»åŠ ç¼“å­˜è§„åˆ™**ï¼š
   ```
   æ–‡ä»¶ç±»åž‹: å›¾ç‰‡æ–‡ä»¶
   ç¼“å­˜æ—¶é—´: 31536000 ç§’ï¼ˆ1å¹´ï¼‰
   è·¯å¾„: /pis-photos/processed/*
   ```

### æ­¥éª¤ 4ï¼šé…ç½® HTTPS

1. **è¿›å…¥ "HTTPSé…ç½®"**
2. **é…ç½® SSL è¯ä¹¦**
3. **å¯ç”¨ HTTPS**

---

## ðŸ” éªŒè¯ CDN é…ç½®

### æ–¹æ³• 1ï¼šæ£€æŸ¥ DNS è§£æž

```bash
dig +short media.yourdomain.com
# æˆ–
nslookup media.yourdomain.com
```

**é¢„æœŸç»“æžœ**ï¼š
- Cloudflare: çœ‹åˆ° `104.x.x.x` æˆ– `172.x.x.x` ç­‰ Cloudflare IP
- é˜¿é‡Œäº‘/è…¾è®¯äº‘: çœ‹åˆ° CDN èŠ‚ç‚¹ IP

### æ–¹æ³• 2ï¼šæ£€æŸ¥å“åº”å¤´

```bash
curl -I https://media.yourdomain.com/pis-photos/processed/thumbs/test.jpg
```

**Cloudflare é¢„æœŸå“åº”å¤´**ï¼š
```
HTTP/2 200
CF-Cache-Status: HIT æˆ– MISS
CF-Ray: xxxxx-XXX
Server: cloudflare
```

**å…³é”®æŒ‡æ ‡**ï¼š
- âœ… `CF-Cache-Status: HIT` - ç¼“å­˜å‘½ä¸­ï¼ˆæœ€ä½³ï¼‰
- âš ï¸ `CF-Cache-Status: MISS` - é¦–æ¬¡è®¿é—®ï¼Œæ­£å¸¸
- âŒ æ²¡æœ‰ `CF-Cache-Status` - CDN æœªç”Ÿæ•ˆ

### æ–¹æ³• 3ï¼šæ€§èƒ½æµ‹è¯•

```bash
# é¦–æ¬¡è®¿é—®ï¼ˆMISSï¼‰
time curl -o /dev/null -s https://media.yourdomain.com/pis-photos/processed/thumbs/test.jpg

# ç¬¬äºŒæ¬¡è®¿é—®ï¼ˆåº”è¯¥æ˜¯ HITï¼‰
time curl -o /dev/null -s https://media.yourdomain.com/pis-photos/processed/thumbs/test.jpg
```

**é¢„æœŸç»“æžœ**ï¼š
- é¦–æ¬¡è®¿é—®ï¼š200-500ms
- ç¼“å­˜å‘½ä¸­ï¼š50-150msï¼ˆæå‡ 60-80%ï¼‰

---

## ðŸŒ CDN èŠ‚ç‚¹é€‰æ‹©è¯´æ˜Ž

### è‡ªåŠ¨è·¯ç”±ï¼ˆæŽ¨èï¼‰

Cloudflare ä½¿ç”¨ **Anycast ç½‘ç»œ**ï¼ŒèŠ‚ç‚¹é€‰æ‹©æ˜¯**è‡ªåŠ¨çš„**ï¼š

- âœ… **è‡ªåŠ¨è·¯ç”±**ï¼šæ ¹æ®è®¿é—®è€…åœ°ç†ä½ç½®è‡ªåŠ¨é€‰æ‹©æœ€è¿‘çš„èŠ‚ç‚¹
- âœ… **æ™ºèƒ½ä¼˜åŒ–**ï¼šä¼˜å…ˆè€ƒè™‘ç¨³å®šæ€§å’Œæ€§èƒ½
- âœ… **å…¨çƒè¦†ç›–**ï¼š300+ æ•°æ®ä¸­å¿ƒ

**å·¥ä½œåŽŸç†**ï¼š
- ðŸ‡¨ðŸ‡³ ä¸­å›½ç”¨æˆ·è®¿é—® â†’ è‡ªåŠ¨ä½¿ç”¨åŒ—äº¬/ä¸Šæµ·èŠ‚ç‚¹
- ðŸ‡¯ðŸ‡µ æ—¥æœ¬ç”¨æˆ·è®¿é—® â†’ è‡ªåŠ¨ä½¿ç”¨ä¸œäº¬èŠ‚ç‚¹
- ðŸ‡ºðŸ‡¸ ç¾Žå›½ç”¨æˆ·è®¿é—® â†’ è‡ªåŠ¨ä½¿ç”¨ç¾Žå›½èŠ‚ç‚¹

**æ¯ä¸ªè®¿é—®è€…éƒ½ä¼šè‡ªåŠ¨è·¯ç”±åˆ°ç¦»ä»–æœ€è¿‘çš„èŠ‚ç‚¹**ï¼Œè¿™æ˜¯ CDN çš„æ ¸å¿ƒä¼˜åŠ¿ï¼

### æŸ¥çœ‹å½“å‰èŠ‚ç‚¹

```bash
curl -I https://media.yourdomain.com/pis-photos/processed/thumbs/test.jpg | grep cf-ray
```

**èŠ‚ç‚¹ä»£ç è¯´æ˜Ž**ï¼ˆCloudflareï¼‰ï¼š
- `NRT` = ä¸œäº¬ï¼ˆTokyoï¼‰
- `PEK` = åŒ—äº¬ï¼ˆBeijingï¼‰
- `SHA` = ä¸Šæµ·ï¼ˆShanghaiï¼‰
- `HKG` = é¦™æ¸¯ï¼ˆHong Kongï¼‰
- `SIN` = æ–°åŠ å¡ï¼ˆSingaporeï¼‰

---

## ðŸ”§ æ•…éšœæŽ’æŸ¥

### é—®é¢˜ 1ï¼šDNS å·²åˆ‡æ¢ä½† CDN ä¸ç”Ÿæ•ˆ

**å¯èƒ½åŽŸå› **ï¼š
- DNS è®°å½•çŠ¶æ€æ˜¯ "DNS only"ï¼ˆç°è‰²äº‘æœµï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. è¿›å…¥ Cloudflare DNS è®¾ç½®
2. ç‚¹å‡» DNS è®°å½•æ—è¾¹çš„äº‘æœµå›¾æ ‡
3. ç¡®ä¿æ˜¯ **ðŸŸ  Proxied**ï¼ˆæ©™è‰²ï¼‰

### é—®é¢˜ 2ï¼šç¼“å­˜ä¸ç”Ÿæ•ˆ

**å¯èƒ½åŽŸå› **ï¼š
- æ²¡æœ‰é…ç½® Cache Rules æˆ– Page Rules
- ç¼“å­˜è§„åˆ™è·¯å¾„ä¸åŒ¹é…

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ Cache Rules æˆ– Page Rules æ˜¯å¦å·²åˆ›å»º
2. ç¡®è®¤ URL Pattern åŒ¹é…æ­£ç¡®
3. æ¸…é™¤ CDN ç¼“å­˜åŽé‡æ–°æµ‹è¯•

### é—®é¢˜ 3ï¼šå›¾ç‰‡æ— æ³•è®¿é—®

**å¯èƒ½åŽŸå› **ï¼š
- æºç«™ä¸å¯è®¿é—®
- SSL è¯ä¹¦é…ç½®é”™è¯¯
- CORS é…ç½®é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥æºç«™æ˜¯å¦å¯è®¿é—®
curl -I http://your-origin-server.com/pis-photos/processed/thumbs/test.jpg

# æ£€æŸ¥ Cloudflare SSL è®¾ç½®
# è¿›å…¥ "SSL/TLS" -> "Overview"
# è®¾ç½®ä¸º "Full"ï¼ˆå¦‚æžœæºç«™æ˜¯ HTTPï¼‰
# æˆ– "Full (strict)"ï¼ˆå¦‚æžœæºç«™æ˜¯ HTTPSï¼‰
```

---

## ðŸ“Š æ€§èƒ½ç›‘æŽ§

### åœ¨ Cloudflare æŽ§åˆ¶å°æŸ¥çœ‹

1. **è¿›å…¥ Analytics -> Caching**
2. **æŸ¥çœ‹æŒ‡æ ‡**ï¼š
   - Cache Hit Ratioï¼ˆç¼“å­˜å‘½ä¸­çŽ‡ï¼‰
   - ç›®æ ‡ï¼š> 70%

### ä½¿ç”¨å‘½ä»¤è¡Œç›‘æŽ§

```bash
# ç›‘æŽ§ç¼“å­˜çŠ¶æ€
watch -n 5 'curl -I https://media.yourdomain.com/pis-photos/processed/thumbs/test.jpg 2>&1 | grep cf-cache-status'
```

---

## âœ… é…ç½®æ£€æŸ¥æ¸…å•

- [ ] DNS è®°å½•çŠ¶æ€æ˜¯ ðŸŸ  Proxiedï¼ˆCloudflareï¼‰
- [ ] SSL/TLS è®¾ç½®ä¸º Full æˆ– Full (strict)
- [ ] Cache Rules æˆ– Page Rules å·²é…ç½®ç¼“å­˜è§„åˆ™
- [ ] å“åº”å¤´åŒ…å« CF-Cache-Statusï¼ˆCloudflareï¼‰
- [ ] å“åº”å¤´åŒ…å« CF-Rayï¼ˆCloudflareï¼‰
- [ ] Brotli åŽ‹ç¼©å·²å¯ç”¨
- [ ] HTTP/3 å·²å¯ç”¨
- [ ] ç¼“å­˜å‘½ä¸­çŽ‡ > 70%
- [ ] å›¾ç‰‡åŠ è½½é€Ÿåº¦ < 200msï¼ˆç¼“å­˜å‘½ä¸­ï¼‰

---

## ðŸ“ˆ æ€§èƒ½ä¼˜åŒ–é¢„æœŸ

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–åŽ | æå‡ |
|------|--------|--------|------|
| ç¼“å­˜å‘½ä¸­çŽ‡ | 0% | 70-90% | âœ… |
| å›¾ç‰‡åŠ è½½ï¼ˆHITï¼‰ | 200-500ms | 50-150ms | **60-80%** |
| å¸¦å®½èŠ‚çœ | - | 70-90% | âœ… |
| æºç«™åŽ‹åŠ› | 100% | 10-30% | âœ… |

---

---

## ðŸ”„ ç¼“å­˜æ¸…é™¤é…ç½®ï¼ˆå¯é€‰ï¼‰

å¦‚æžœä½¿ç”¨ Cloudflare CDNï¼Œå¯ä»¥é…ç½®è‡ªåŠ¨æ¸…é™¤ç¼“å­˜åŠŸèƒ½ï¼Œç¡®ä¿åˆ é™¤ç…§ç‰‡åŽ CDN ç¼“å­˜ä¹Ÿè¢«æ¸…é™¤ã€‚

### æ­¥éª¤ 1ï¼šèŽ·å– Cloudflare API Token

1. **ç™»å½• Cloudflare æŽ§åˆ¶å°**
   - è®¿é—®ï¼šhttps://dash.cloudflare.com/
   - ä½¿ç”¨ä½ çš„è´¦å·ç™»å½•

2. **åˆ›å»º API ä»¤ç‰Œ**
   - ç‚¹å‡»å³ä¸Šè§’å¤´åƒ â†’ **æˆ‘çš„ä¸ªäººèµ„æ–™**ï¼ˆæˆ– **My Profile**ï¼‰
   - å·¦ä¾§èœå•é€‰æ‹© **API ä»¤ç‰Œ**ï¼ˆæˆ– **API Tokens**ï¼‰
   - ç‚¹å‡» **åˆ›å»ºä»¤ç‰Œ**ï¼ˆæˆ– **Create Token**ï¼‰

3. **é…ç½®ä»¤ç‰Œæƒé™**
   - åœ¨ **æƒé™** éƒ¨åˆ†ï¼Œç‚¹å‡» **æ·»åŠ æ›´å¤š** æ·»åŠ æƒé™ï¼š
     - **åŒºåŸŸ** â†’ **æ¸…é™¤ç¼“å­˜** â†’ **æ¸…é™¤**
   - åœ¨ **åŒºåŸŸèµ„æº** éƒ¨åˆ†ï¼š
     - é€‰æ‹© **åŒ…æ‹¬** â†’ **ç‰¹å®šåŒºåŸŸ**
     - ç‚¹å‡» **Select...** ä¸‹æ‹‰æ¡†
     - é€‰æ‹©ä½ çš„åŸŸåï¼ˆå¦‚ `example.com`ï¼‰
   - **å®¢æˆ·ç«¯ IP åœ°å€ç­›é€‰**ï¼šå¯ä»¥ç•™ç©ºï¼ˆé»˜è®¤é€‚ç”¨äºŽæ‰€æœ‰åœ°å€ï¼‰
   - **TTL**ï¼šå¯ä»¥ç•™ç©ºï¼ˆé»˜è®¤æ°¸ä¹…æœ‰æ•ˆï¼‰

4. **åˆ›å»ºå¹¶å¤åˆ¶ä»¤ç‰Œ**
   - é…ç½®å®ŒæˆåŽï¼Œæ»šåŠ¨åˆ°é¡µé¢åº•éƒ¨
   - ç‚¹å‡» **åˆ›å»ºä»¤ç‰Œ** æŒ‰é’®
   - **é‡è¦**ï¼šç«‹å³å¤åˆ¶æ˜¾ç¤ºçš„ä»¤ç‰Œï¼ˆåªæ˜¾ç¤ºä¸€æ¬¡ï¼Œå…³é—­åŽæ— æ³•å†æ¬¡æŸ¥çœ‹ï¼‰
   - æ ¼å¼ç±»ä¼¼ï¼š`xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`
   - å»ºè®®ä¿å­˜åˆ°å®‰å…¨çš„åœ°æ–¹ï¼ˆå¦‚å¯†ç ç®¡ç†å™¨ï¼‰

### æ­¥éª¤ 2ï¼šèŽ·å–åŒºåŸŸ IDï¼ˆZone IDï¼‰

1. **è¿›å…¥åŸŸåç®¡ç†**
   - åœ¨ Cloudflare æŽ§åˆ¶å°é¦–é¡µ
   - ç‚¹å‡»ä½ çš„åŸŸåï¼ˆå¦‚ `example.com`ï¼‰

2. **æ‰¾åˆ°åŒºåŸŸ ID**
   - åœ¨å³ä¾§è¾¹æ ï¼ˆæ¦‚è§ˆé¡µé¢ï¼Œæˆ– **Overview**ï¼‰
   - æ‰¾åˆ° **åŒºåŸŸ ID**ï¼ˆæˆ– **Zone ID**ï¼Œä¸€ä¸²å­—æ¯æ•°å­—ï¼‰
   - ç‚¹å‡»å¤åˆ¶
   - æ ¼å¼ç±»ä¼¼ï¼š`xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`

### æ­¥éª¤ 3ï¼šé…ç½®çŽ¯å¢ƒå˜é‡

#### åœ¨ Vercel ä¸­é…ç½®

1. **è¿›å…¥ Vercel æŽ§åˆ¶å°**
   - è®¿é—®ï¼šhttps://vercel.com/dashboard
   - é€‰æ‹©ä½ çš„é¡¹ç›®

2. **æ·»åŠ çŽ¯å¢ƒå˜é‡**
   - è¿›å…¥ **è®¾ç½®**ï¼ˆæˆ– **Settings**ï¼‰â†’ **çŽ¯å¢ƒå˜é‡**ï¼ˆæˆ– **Environment Variables**ï¼‰
   - æ·»åŠ ä»¥ä¸‹å˜é‡ï¼š

   ```
   å˜é‡å: CLOUDFLARE_API_TOKEN
   å€¼: ä½ çš„ API ä»¤ç‰Œï¼ˆæ­¥éª¤ 1 èŽ·å–çš„ï¼‰
   çŽ¯å¢ƒ: Productionï¼ˆç”Ÿäº§çŽ¯å¢ƒï¼‰ã€Previewï¼ˆé¢„è§ˆçŽ¯å¢ƒï¼‰ã€Developmentï¼ˆå¼€å‘çŽ¯å¢ƒï¼‰ï¼ˆå…¨é€‰ï¼‰
   ```

   ```
   å˜é‡å: CLOUDFLARE_ZONE_ID
   å€¼: ä½ çš„åŒºåŸŸ IDï¼ˆæ­¥éª¤ 2 èŽ·å–çš„ï¼‰
   çŽ¯å¢ƒ: Productionï¼ˆç”Ÿäº§çŽ¯å¢ƒï¼‰ã€Previewï¼ˆé¢„è§ˆçŽ¯å¢ƒï¼‰ã€Developmentï¼ˆå¼€å‘çŽ¯å¢ƒï¼‰ï¼ˆå…¨é€‰ï¼‰
   ```

3. **ä¿å­˜å¹¶é‡æ–°éƒ¨ç½²**
   - ç‚¹å‡» **ä¿å­˜**ï¼ˆæˆ– **Save**ï¼‰
   - é‡æ–°éƒ¨ç½²åº”ç”¨ï¼ˆæˆ–ç­‰å¾…ä¸‹æ¬¡éƒ¨ç½²ï¼‰

#### åœ¨ Worker æœåŠ¡ä¸­é…ç½®

å¦‚æžœä½ çš„ Worker æœåŠ¡æ˜¯ç‹¬ç«‹éƒ¨ç½²çš„ï¼ˆä¸åœ¨ Vercelï¼‰ï¼Œéœ€è¦åœ¨ Worker æœåŠ¡çš„çŽ¯å¢ƒå˜é‡ä¸­é…ç½®ï¼š

```bash
# Worker æœåŠ¡çŽ¯å¢ƒå˜é‡
CLOUDFLARE_API_TOKEN=ä½ çš„ API Token
CLOUDFLARE_ZONE_ID=ä½ çš„ Zone ID
```

**é…ç½®æ–¹å¼å–å†³äºŽä½ çš„éƒ¨ç½²æ–¹å¼**ï¼š
- **Docker**: åœ¨ `docker-compose.yml` æˆ–å¯åŠ¨å‘½ä»¤ä¸­æ·»åŠ çŽ¯å¢ƒå˜é‡
- **PM2**: åœ¨ `ecosystem.config.js` ä¸­é…ç½®
- **systemd**: åœ¨æœåŠ¡é…ç½®æ–‡ä»¶ä¸­æ·»åŠ çŽ¯å¢ƒå˜é‡
- **å…¶ä»–**: æ ¹æ®ä½ çš„éƒ¨ç½²æ–¹å¼é…ç½®

**ç¤ºä¾‹ï¼ˆdocker-compose.ymlï¼‰**ï¼š
```yaml
services:
  worker:
    environment:
      # ... å…¶ä»–çŽ¯å¢ƒå˜é‡ ...
      - CLOUDFLARE_API_TOKEN=${CLOUDFLARE_API_TOKEN:-}
      - CLOUDFLARE_ZONE_ID=${CLOUDFLARE_ZONE_ID:-}
```

ç„¶åŽåœ¨æœåŠ¡å™¨ä¸Šçš„ `.env.local` æ–‡ä»¶ä¸­æ·»åŠ ï¼š
```bash
CLOUDFLARE_API_TOKEN=ä½ çš„ API ä»¤ç‰Œ
CLOUDFLARE_ZONE_ID=ä½ çš„åŒºåŸŸ ID
```

### æ­¥éª¤ 4ï¼šéªŒè¯é…ç½®

é…ç½®å®ŒæˆåŽï¼Œåˆ é™¤ä¸€å¼ ç…§ç‰‡ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ¸…é™¤è¯¥ç…§ç‰‡åœ¨ Cloudflare CDN ä¸­çš„ç¼“å­˜ã€‚

**éªŒè¯æ–¹æ³•**ï¼š
1. åˆ é™¤ä¸€å¼ ç…§ç‰‡
2. æŸ¥çœ‹ Worker æ—¥å¿—ï¼Œåº”è¯¥çœ‹åˆ°ç¼“å­˜æ¸…é™¤æˆåŠŸçš„æ—¥å¿—
3. æˆ–ç›´æŽ¥è®¿é—®å·²åˆ é™¤ç…§ç‰‡çš„ URLï¼Œåº”è¯¥è¿”å›ž 404 æˆ–æ— æ³•è®¿é—®

### âš ï¸ å®‰å…¨æ³¨æ„äº‹é¡¹

- **API Token å®‰å…¨**ï¼š
  - API Token å…·æœ‰æ¸…é™¤ç¼“å­˜çš„æƒé™ï¼Œè¯·å¦¥å–„ä¿ç®¡
  - ä¸è¦å°† Token æäº¤åˆ°ä»£ç ä»“åº“
  - å®šæœŸè½®æ¢ Tokenï¼ˆå»ºè®®æ¯ 90 å¤©ï¼‰
  - å¦‚æžœ Token æ³„éœ²ï¼Œç«‹å³åœ¨ Cloudflare æŽ§åˆ¶å°åˆ é™¤å¹¶é‡æ–°åˆ›å»º

- **æƒé™æœ€å°åŒ–**ï¼š
  - åªæŽˆäºˆå¿…è¦çš„æƒé™ï¼ˆæ¸…é™¤ç¼“å­˜ï¼‰
  - åªé’ˆå¯¹ç‰¹å®šåŸŸåï¼Œä¸è¦ä½¿ç”¨å…¨å±€æƒé™

---

## ðŸ“š ç›¸å…³æ–‡æ¡£

- [æ€§èƒ½ä¼˜åŒ–æŒ‡å—](./PERFORMANCE_OPTIMIZATION.md)
- [å®‰å…¨æœ€ä½³å®žè·µ](./SECURITY.md)
