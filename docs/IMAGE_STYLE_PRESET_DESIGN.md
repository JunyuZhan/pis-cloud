# å›¾ç‰‡è°ƒè‰²åŠŸèƒ½è®¾è®¡æ–‡æ¡£

> æœ€åæ›´æ–°: 2026-01-28

## ğŸ“‹ ç›®å½•

1. [åŠŸèƒ½æ¦‚è¿°](#åŠŸèƒ½æ¦‚è¿°)
2. [éœ€æ±‚åˆ†æ](#éœ€æ±‚åˆ†æ)
3. [æŠ€æœ¯æ–¹æ¡ˆ](#æŠ€æœ¯æ–¹æ¡ˆ)
4. [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)
5. [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
6. [API è®¾è®¡](#api-è®¾è®¡)
7. [å‰ç«¯è®¾è®¡](#å‰ç«¯è®¾è®¡)
8. [å®ç°è®¡åˆ’](#å®ç°è®¡åˆ’)
9. [æ€§èƒ½è€ƒè™‘](#æ€§èƒ½è€ƒè™‘)
10. [æµ‹è¯•è®¡åˆ’](#æµ‹è¯•è®¡åˆ’)

---

## åŠŸèƒ½æ¦‚è¿°

### ç›®æ ‡

ä¸º PIS ç³»ç»Ÿæ·»åŠ å›¾ç‰‡é£æ ¼é¢„è®¾åŠŸèƒ½ï¼Œå…è®¸ç®¡ç†å‘˜ä¸ºç›¸å†Œé€‰æ‹©é¢„è®¾çš„è°ƒè‰²é£æ ¼ï¼ˆå¦‚æ—¥ç³»å°æ¸…æ–°ã€ç”µå½±æ„Ÿã€è‡ªç„¶é£å…‰ç­‰ï¼‰ï¼Œç³»ç»Ÿåœ¨å¤„ç†ç…§ç‰‡æ—¶è‡ªåŠ¨åº”ç”¨è¿™äº›é£æ ¼æ•ˆæœã€‚é¢„è®¾åŸºäº Lightroom è°ƒè‰²æ€è·¯ï¼Œç®€å•å¯é ï¼Œæ— éœ€ä¸“ä¸šè°ƒè‰²çŸ¥è¯†ã€‚

### æ ¸å¿ƒä»·å€¼

- **ç®€å•æ˜“ç”¨**ï¼šåªéœ€é€‰æ‹©é¢„è®¾é£æ ¼ï¼Œæ— éœ€ä¸“ä¸šè°ƒè‰²çŸ¥è¯†
- **ç»Ÿä¸€é£æ ¼**ï¼šä¸ºæ•´ä¸ªç›¸å†Œåº”ç”¨ç»Ÿä¸€çš„è§†è§‰é£æ ¼ï¼Œæå‡ä¸“ä¸šåº¦
- **æ‰¹é‡å¤„ç†**ï¼šè‡ªåŠ¨ä¸ºç›¸å†Œå†…æ‰€æœ‰ç…§ç‰‡åº”ç”¨é£æ ¼ï¼Œæ— éœ€æ‰‹åŠ¨è°ƒæ•´
- **é¢„è®¾å¯é **ï¼šé¢„è®¾åŸºäºæˆç†Ÿçš„ Lightroom è°ƒè‰²æ€è·¯ï¼Œæ•ˆæœç¨³å®š
- **æ€§èƒ½ä¼˜åŒ–**ï¼šæœåŠ¡ç«¯å¤„ç†ï¼Œä¸€æ¬¡ç”Ÿæˆæ°¸ä¹…ä½¿ç”¨

---

## éœ€æ±‚åˆ†æ

### åŠŸèƒ½éœ€æ±‚

1. **é£æ ¼é¢„è®¾ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰**
   - **äººç‰©é£æ ¼**ï¼šæ—¥ç³»å°æ¸…æ–°ã€èƒ¶ç‰‡æ„Ÿã€ç”µå½±æ„Ÿã€å†™å®ã€æ¸©æš–äººåƒç­‰
   - **é£æ™¯é£æ ¼**ï¼šè‡ªç„¶é£å…‰ã€ç”µå½±æ„Ÿã€èƒ¶ç‰‡ã€æ€€æ—§ç¾å­¦ã€æ¸…æ–°è‡ªç„¶ç­‰
   - **é€šç”¨é£æ ¼**ï¼šé»‘ç™½ã€å¤å¤ã€é²œè‰³ç­‰
   - é¢„è®¾åŸºäº Lightroom è°ƒè‰²æ€è·¯ï¼Œæ•ˆæœå¯é 
   - é¢„è®¾æ•°é‡ï¼š15-20 ä¸ªï¼ˆåˆ†ç±»æ¸…æ™°ï¼Œä¸è¿‡å¤šï¼‰

2. **ç›¸å†Œçº§åˆ«é…ç½®**
   - æ¯ä¸ªç›¸å†Œå¯é€‰æ‹©ä¸€ç§é¢„è®¾é£æ ¼
   - é£æ ¼é…ç½®å­˜å‚¨åœ¨ç›¸å†Œè¡¨ä¸­ï¼ˆJSONBï¼‰
   - æ”¯æŒ"æ— é£æ ¼"é€‰é¡¹ï¼ˆä¿æŒåŸå§‹è‰²å½©ï¼‰
   - æ”¯æŒé¢„è§ˆæ•ˆæœï¼ˆå‰ç«¯ CSS æ»¤é•œï¼‰

3. **å›¾ç‰‡å¤„ç†**
   - åœ¨ Worker å¤„ç†å›¾ç‰‡æ—¶åº”ç”¨é£æ ¼é¢„è®¾
   - åªå¤„ç†é¢„è§ˆå›¾å’Œç¼©ç•¥å›¾ï¼ŒåŸå›¾ä¿æŒä¸å˜
   - æ”¯æŒé‡æ–°å¤„ç†å·²ä¸Šä¼ çš„ç…§ç‰‡ï¼ˆåˆ‡æ¢é£æ ¼æ—¶ï¼‰

4. **ç”¨æˆ·ä½“éªŒ**
   - åˆ›å»ºç›¸å†Œæ—¶å¯é€‰æ‹©é£æ ¼ï¼ˆå¯é€‰ï¼‰
   - ç›¸å†Œè®¾ç½®é¡µé¢å¯åˆ‡æ¢é£æ ¼
   - é¢„è®¾åˆ†ç±»å±•ç¤ºï¼ˆäººç‰©/é£æ™¯/é€šç”¨ï¼‰
   - æ¯ä¸ªé¢„è®¾æ˜¾ç¤ºé¢„è§ˆå›¾å’Œè¯´æ˜
   - å®æ—¶é¢„è§ˆæ•ˆæœï¼ˆCSS æ»¤é•œï¼‰

### éåŠŸèƒ½éœ€æ±‚

- **æ€§èƒ½**ï¼šé£æ ¼å¤„ç†ä¸åº”æ˜¾è‘—å¢åŠ å›¾ç‰‡å¤„ç†æ—¶é—´ï¼ˆ< 20%ï¼‰
- **å…¼å®¹æ€§**ï¼šå‘åå…¼å®¹ï¼Œæœªé…ç½®é£æ ¼çš„ç›¸å†Œä¿æŒåŸæ ·
- **å¯æ‰©å±•æ€§**ï¼šæ˜“äºæ·»åŠ æ–°çš„é£æ ¼é¢„è®¾

---

## æŠ€æœ¯æ–¹æ¡ˆ

### æ–¹æ¡ˆå¯¹æ¯”

#### æ–¹æ¡ˆä¸€ï¼šçº¯æœåŠ¡ç«¯å¤„ç†ï¼ˆæ¨èï¼‰

**ä¼˜ç‚¹ï¼š**
- ä¸€æ¬¡å¤„ç†ï¼Œæ°¸ä¹…ç”Ÿæ•ˆ
- æ€§èƒ½å¥½ï¼Œæ— éœ€å‰ç«¯å®æ—¶è®¡ç®—
- æ”¯æŒæ‰¹é‡å¤„ç†
- ä¸‹è½½çš„å›¾ç‰‡ä¹ŸåŒ…å«é£æ ¼æ•ˆæœ

**ç¼ºç‚¹ï¼š**
- åˆ‡æ¢é£æ ¼éœ€è¦é‡æ–°å¤„ç†æ‰€æœ‰ç…§ç‰‡
- å­˜å‚¨ç©ºé—´ç•¥å¢ï¼ˆä½†å¯æ¥å—ï¼‰

#### æ–¹æ¡ˆäºŒï¼šçº¯å‰ç«¯ CSS æ»¤é•œ

**ä¼˜ç‚¹ï¼š**
- æ— éœ€é‡æ–°å¤„ç†å›¾ç‰‡
- å®æ—¶åˆ‡æ¢é£æ ¼
- é›¶å­˜å‚¨æˆæœ¬

**ç¼ºç‚¹ï¼š**
- ä¸‹è½½çš„å›¾ç‰‡ä¸åŒ…å«é£æ ¼æ•ˆæœ
- æ€§èƒ½ä¾èµ–æµè§ˆå™¨
- æ•ˆæœæœ‰é™ï¼ˆCSS æ»¤é•œèƒ½åŠ›å—é™ï¼‰

#### æ–¹æ¡ˆä¸‰ï¼šæ··åˆæ–¹æ¡ˆï¼ˆæœ€ç»ˆé€‰æ‹©ï¼‰

**æœåŠ¡ç«¯å¤„ç† + å‰ç«¯é¢„è§ˆ**

- **æœåŠ¡ç«¯**ï¼šä½¿ç”¨ Sharp å¤„ç†å›¾ç‰‡ï¼Œç”Ÿæˆå¸¦é£æ ¼çš„é¢„è§ˆå›¾å’Œç¼©ç•¥å›¾
- **å‰ç«¯é¢„è§ˆ**ï¼šä½¿ç”¨ CSS æ»¤é•œå®ç°å®æ—¶é¢„è§ˆï¼Œæ— éœ€é‡æ–°å¤„ç†
- **æœ€ä½³å®è·µ**ï¼šç»“åˆä¸¤è€…ä¼˜åŠ¿ï¼ŒæœåŠ¡ç«¯ä¿è¯è´¨é‡ï¼Œå‰ç«¯æä¾›çµæ´»æ€§

### æŠ€æœ¯é€‰å‹

#### æœåŠ¡ç«¯å›¾ç‰‡å¤„ç†

ä½¿ç”¨ **Sharp** åº“çš„ä»¥ä¸‹æ–¹æ³•ï¼š

**åŸºç¡€è°ƒæ•´ï¼š**
- `modulate({ brightness, saturation, hue })` - äº®åº¦ã€é¥±å’Œåº¦ã€è‰²ç›¸è°ƒæ•´
- `contrast(value)` - å¯¹æ¯”åº¦è°ƒæ•´ï¼ˆ-1 åˆ° 1ï¼‰
- `linear(multiply, offset)` - çº¿æ€§è°ƒæ•´ï¼ˆå¯¹æ¯”åº¦å’Œäº®åº¦ï¼‰
- `gamma(value)` - ä¼½é©¬æ ¡æ­£
- `normalise()` - è‡ªåŠ¨æ ‡å‡†åŒ–ï¼ˆå¯é€‰ï¼‰

**è‰²å½©è°ƒæ•´ï¼š**
- `tint({ r, g, b })` - è‰²è°ƒå åŠ ï¼ˆç”¨äºè‰²æ¸©/è‰²è°ƒæ¨¡æ‹Ÿï¼‰
- `greyscale()` - é»‘ç™½æ•ˆæœï¼ˆé¥±å’Œåº¦ = 0ï¼‰
- `toColourspace()` - è‰²å½©ç©ºé—´è½¬æ¢ï¼ˆå¯é€‰ï¼‰

**è‰²è°ƒè°ƒæ•´ï¼ˆé€šè¿‡ç»„åˆå®ç°ï¼‰ï¼š**
- é«˜å…‰/é˜´å½±ï¼šä½¿ç”¨ `linear()` å’Œ `gamma()` ç»„åˆå®ç°
- è‰²æ¸©ï¼šä½¿ç”¨ `tint()` æˆ– `modulate()` çš„ hue å‚æ•°æ¨¡æ‹Ÿ
- è‰²è°ƒï¼ˆTintï¼‰ï¼šä½¿ç”¨ `tint()` çš„ RGB å‚æ•°å®ç°

**æ³¨æ„ï¼š** Sharp ä¸ç›´æ¥æ”¯æŒé«˜å…‰/é˜´å½±è°ƒæ•´ï¼Œéœ€è¦é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¨¡æ‹Ÿï¼š
- é«˜å…‰ï¼šé™ä½ gamma + æé«˜ brightness
- é˜´å½±ï¼šæé«˜ gamma + é™ä½ brightness
- æˆ–ä½¿ç”¨ `linear()` çš„ multiply/offset å‚æ•°

#### å‰ç«¯é¢„è§ˆ

ä½¿ç”¨ **CSS Filter** å±æ€§ï¼š

- `brightness()` - äº®åº¦
- `contrast()` - å¯¹æ¯”åº¦
- `saturate()` - é¥±å’Œåº¦
- `hue-rotate()` - è‰²ç›¸æ—‹è½¬
- `sepia()` - å¤å¤æ•ˆæœ
- `grayscale()` - é»‘ç™½æ•ˆæœ

---

## æ•°æ®åº“è®¾è®¡

### ç›¸å†Œè¡¨æ‰©å±•

åœ¨ `albums` è¡¨ä¸­æ·»åŠ  `style_preset` å­—æ®µï¼š

```sql
-- æ·»åŠ è°ƒè‰²é…ç½®å­—æ®µ
ALTER TABLE albums 
ADD COLUMN color_grading JSONB DEFAULT NULL;

-- å­—æ®µè¯´æ˜ï¼š
-- color_grading: null | {
--   "preset": "preset-id",  // é¢„è®¾ IDï¼ˆå¦‚ "japanese-fresh", "cinematic-portrait" ç­‰ï¼‰
--   
--   // é¢„è®¾å†…éƒ¨å‚æ•°ï¼ˆç”±ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆï¼Œç®¡ç†å‘˜æ— éœ€å…³å¿ƒï¼‰
--   "brightness": 1.0,      // äº®åº¦è°ƒæ•´
--   "contrast": 0.0,        // å¯¹æ¯”åº¦è°ƒæ•´
--   "saturation": 1.0,      // é¥±å’Œåº¦è°ƒæ•´
--   "gamma": 1.0,           // ä¼½é©¬æ ¡æ­£
--   "hue": 0,               // è‰²ç›¸æ—‹è½¬
--   "tint": { r, g, b }     // è‰²è°ƒå åŠ ï¼ˆç”¨äºè‰²æ¸©æ¨¡æ‹Ÿï¼‰
-- }
--
-- æ³¨æ„ï¼šç®¡ç†å‘˜åªéœ€è¦é€‰æ‹©é¢„è®¾ IDï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åº”ç”¨å¯¹åº”çš„å‚æ•°
```

### ç´¢å¼•

æ— éœ€é¢å¤–ç´¢å¼•ï¼ˆJSONB å­—æ®µå·²æ”¯æŒ GIN ç´¢å¼•ï¼Œä½†å½“å‰æŸ¥è¯¢åœºæ™¯ä¸éœ€è¦ï¼‰

### JSON Schema æ ¡éªŒï¼ˆé‡è¦ï¼‰

ä¸ºé˜²æ­¢å‰ç«¯ä¼ é”™å‚æ•°èŒƒå›´å¯¼è‡´åç«¯ Sharp æŠ¥é”™ï¼Œå»ºè®®åœ¨æ•°æ®åº“å±‚é¢æ·»åŠ  JSON Schema æ ¡éªŒï¼š

```sql
-- åˆ›å»ºæ ¡éªŒå‡½æ•°
CREATE OR REPLACE FUNCTION validate_color_grading(config JSONB)
RETURNS BOOLEAN AS $$
BEGIN
  IF config IS NULL THEN
    RETURN TRUE;  -- NULL æ˜¯å…è®¸çš„ï¼ˆè¡¨ç¤ºæ— è°ƒè‰²ï¼‰
  END IF;
  
  -- éªŒè¯åŸºç¡€è°ƒæ•´å‚æ•°èŒƒå›´
  IF config->'basic' IS NOT NULL THEN
    IF (config->'basic'->>'brightness')::numeric < 0.0 OR 
       (config->'basic'->>'brightness')::numeric > 2.0 THEN
      RETURN FALSE;
    END IF;
    IF (config->'basic'->>'contrast')::numeric < -1.0 OR 
       (config->'basic'->>'contrast')::numeric > 1.0 THEN
      RETURN FALSE;
    END IF;
    IF (config->'basic'->>'saturation')::numeric < 0.0 OR 
       (config->'basic'->>'saturation')::numeric > 2.0 THEN
      RETURN FALSE;
    END IF;
    IF (config->'basic'->>'gamma')::numeric < 0.1 OR 
       (config->'basic'->>'gamma')::numeric > 3.0 THEN
      RETURN FALSE;
    END IF;
  END IF;
  
  -- éªŒè¯è‰²è°ƒè°ƒæ•´å‚æ•°èŒƒå›´
  IF config->'tone' IS NOT NULL THEN
    IF (config->'tone'->>'highlights')::numeric < -1.0 OR 
       (config->'tone'->>'highlights')::numeric > 1.0 THEN
      RETURN FALSE;
    END IF;
    IF (config->'tone'->>'shadows')::numeric < -1.0 OR 
       (config->'tone'->>'shadows')::numeric > 1.0 THEN
      RETURN FALSE;
    END IF;
    -- ... å…¶ä»–å‚æ•°æ ¡éªŒ
  END IF;
  
  -- éªŒè¯è‰²å½©è°ƒæ•´å‚æ•°èŒƒå›´
  IF config->'color' IS NOT NULL THEN
    IF (config->'color'->>'temperature')::integer < -100 OR 
       (config->'color'->>'temperature')::integer > 100 THEN
      RETURN FALSE;
    END IF;
    IF (config->'color'->>'tint')::integer < -100 OR 
       (config->'color'->>'tint')::integer > 100 THEN
      RETURN FALSE;
    END IF;
    IF (config->'color'->>'hue')::integer < 0 OR 
       (config->'color'->>'hue')::integer > 360 THEN
      RETURN FALSE;
    END IF;
  END IF;
  
  RETURN TRUE;
END;
$$ LANGUAGE plpgsql;

-- æ·»åŠ  CHECK çº¦æŸ
ALTER TABLE albums 
ADD CONSTRAINT check_color_grading_valid 
CHECK (validate_color_grading(color_grading));
```

**æ³¨æ„ï¼š** åŒæ—¶åœ¨å‰ç«¯å’Œåç«¯ API å±‚ä¹Ÿè¦è¿›è¡Œæ ¡éªŒï¼Œå½¢æˆä¸‰å±‚é˜²æŠ¤ã€‚

---

## æ¶æ„è®¾è®¡

### æ•°æ®æµ

```
ç”¨æˆ·ä¸Šä¼ ç…§ç‰‡
    â†“
å‰ç«¯ API (/api/admin/albums/[id]/upload)
    â†“
åˆ›å»ºç…§ç‰‡è®°å½•ï¼ˆstatus: 'pending'ï¼‰
    â†“
åŠ å…¥å¤„ç†é˜Ÿåˆ—ï¼ˆBullMQï¼‰
    â†“
Worker å¤„ç†
    â”œâ”€ è¯»å–ç›¸å†Œé…ç½®ï¼ˆåŒ…å« color_gradingï¼‰
    â”œâ”€ ä¸‹è½½åŸå§‹å›¾ç‰‡
    â”œâ”€ åº”ç”¨è°ƒè‰²é…ç½®ï¼ˆPhotoProcessor.applyColorGradingï¼‰
    â”‚   â”œâ”€ åŸºç¡€è°ƒæ•´ï¼ˆäº®åº¦ã€å¯¹æ¯”åº¦ã€é¥±å’Œåº¦ç­‰ï¼‰
    â”‚   â”œâ”€ è‰²è°ƒè°ƒæ•´ï¼ˆé«˜å…‰ã€é˜´å½±ç­‰ï¼‰
    â”‚   â””â”€ è‰²å½©è°ƒæ•´ï¼ˆè‰²æ¸©ã€è‰²è°ƒã€è‰²ç›¸ç­‰ï¼‰
    â”œâ”€ åº”ç”¨æ°´å°ï¼ˆå¦‚æœå¯ç”¨ï¼‰
    â”œâ”€ ç”Ÿæˆç¼©ç•¥å›¾å’Œé¢„è§ˆå›¾
    â””â”€ ä¸Šä¼ åˆ°å­˜å‚¨
    â†“
æ›´æ–°ç…§ç‰‡çŠ¶æ€ï¼ˆstatus: 'completed'ï¼‰
```

### ç»„ä»¶è®¾è®¡

#### 1. è°ƒè‰²é…ç½®å®šä¹‰ (`services/worker/src/lib/color-grading.ts`)

```typescript
/**
 * åŸºç¡€è°ƒæ•´å‚æ•°
 */
export interface BasicAdjustments {
  brightness?: number;    // 0.0 - 2.0, é»˜è®¤ 1.0
  contrast?: number;      // -1.0 - 1.0, é»˜è®¤ 0.0
  saturation?: number;   // 0.0 - 2.0, é»˜è®¤ 1.0
  exposure?: number;      // -2.0 - 2.0, é»˜è®¤ 0.0ï¼ˆé€šè¿‡ brightness æ¨¡æ‹Ÿï¼‰
  gamma?: number;        // 0.1 - 3.0, é»˜è®¤ 1.0
}

/**
 * è‰²è°ƒè°ƒæ•´å‚æ•°
 */
export interface ToneAdjustments {
  highlights?: number;   // -1.0 - 1.0, é»˜è®¤ 0.0ï¼ˆé€šè¿‡ gamma + brightness æ¨¡æ‹Ÿï¼‰
  shadows?: number;      // -1.0 - 1.0, é»˜è®¤ 0.0ï¼ˆé€šè¿‡ gamma + brightness æ¨¡æ‹Ÿï¼‰
  whites?: number;       // -1.0 - 1.0, é»˜è®¤ 0.0ï¼ˆé€šè¿‡ contrast æ¨¡æ‹Ÿï¼‰
  blacks?: number;       // -1.0 - 1.0, é»˜è®¤ 0.0ï¼ˆé€šè¿‡ contrast æ¨¡æ‹Ÿï¼‰
}

/**
 * è‰²å½©è°ƒæ•´å‚æ•°
 */
export interface ColorAdjustments {
  temperature?: number;  // -100 - 100, é»˜è®¤ 0ï¼ˆè‰²æ¸©ï¼Œé€šè¿‡ tint æˆ– hue æ¨¡æ‹Ÿï¼‰
  tint?: number;         // -100 - 100, é»˜è®¤ 0ï¼ˆè‰²è°ƒï¼Œé€šè¿‡ tint RGB æ¨¡æ‹Ÿï¼‰
  hue?: number;          // 0 - 360, é»˜è®¤ 0ï¼ˆè‰²ç›¸æ—‹è½¬ï¼‰
  vibrance?: number;     // -1.0 - 1.0, é»˜è®¤ 0.0ï¼ˆè‡ªç„¶é¥±å’Œåº¦ï¼‰
}

/**
 * RGB è‰²å½©å¹³è¡¡
 */
export interface ColorBalance {
  r?: number;            // -1.0 - 1.0, é»˜è®¤ 0.0ï¼ˆçº¢è‰²é€šé“ï¼‰
  g?: number;            // -1.0 - 1.0, é»˜è®¤ 0.0ï¼ˆç»¿è‰²é€šé“ï¼‰
  b?: number;            // -1.0 - 1.0, é»˜è®¤ 0.0ï¼ˆè“è‰²é€šé“ï¼‰
}

/**
 * å®Œæ•´è°ƒè‰²é…ç½®
 */
export interface ColorGradingConfig {
  preset?: string;              // é¢„è®¾åç§°ï¼ˆå¯é€‰ï¼Œç”¨äºå¿«æ·åº”ç”¨ï¼‰
  basic?: BasicAdjustments;     // åŸºç¡€è°ƒæ•´
  tone?: ToneAdjustments;       // è‰²è°ƒè°ƒæ•´
  color?: ColorAdjustments;     // è‰²å½©è°ƒæ•´
  colorBalance?: ColorBalance;  // RGB è‰²å½©å¹³è¡¡
}

/**
 * é£æ ¼é¢„è®¾ï¼ˆä½œä¸ºè°ƒè‰²é…ç½®çš„å¿«æ·æ–¹å¼ï¼‰
 */
export interface StylePreset {
  id: string;
  name: string;
  description: string;
  config: ColorGradingConfig;   // å®Œæ•´çš„è°ƒè‰²é…ç½®
  cssFilter?: string;           // ç”¨äºå‰ç«¯é¢„è§ˆçš„ CSS filterï¼ˆéƒ¨åˆ†å‚æ•°ï¼‰
}

export const STYLE_PRESETS: Record<string, StylePreset> = {
  // ========== äººç‰©é£æ ¼ ==========
  'japanese-fresh': {
    id: 'japanese-fresh',
    name: 'æ—¥ç³»å°æ¸…æ–°',
    category: 'portrait',
    description: 'æ¸©æš–æŸ”å’Œçš„å…‰çº¿ï¼Œæ¸©æŸ”æ¸…æ–°çš„æ°›å›´ï¼Œé€‚åˆäººåƒæ‘„å½±',
    config: {
      brightness: 1.05,
      contrast: -0.1,
      saturation: 0.9,
      gamma: 1.05,
      hue: 10,
      tint: { r: 255, g: 250, b: 245 }
    },
    cssFilter: 'brightness(1.05) contrast(0.9) saturate(0.9) hue-rotate(10deg)'
  },
  'film-portrait': {
    id: 'film-portrait',
    name: 'èƒ¶ç‰‡äººåƒ',
    category: 'portrait',
    description: 'æ¨¡æ‹Ÿèƒ¶ç‰‡è´¨æ„Ÿï¼Œå¢å¼ºå±‚æ¬¡æ„Ÿå’Œæ•…äº‹æ€§',
    config: {
      brightness: 1.0,
      contrast: 0.15,
      saturation: 1.1,
      gamma: 1.1,
      hue: 5,
      tint: { r: 255, g: 252, b: 248 }
    },
    cssFilter: 'brightness(1.0) contrast(1.15) saturate(1.1) hue-rotate(5deg)'
  },
  'cinematic-portrait': {
    id: 'cinematic-portrait',
    name: 'ç”µå½±æ„Ÿäººåƒ',
    category: 'portrait',
    description: 'ç”µå½±çº§è°ƒè‰²ï¼ŒæŸ”å’Œçš„é«˜å…‰å’Œæš–è‰²è°ƒï¼Œé€‚åˆæµªæ¼«åœºæ™¯',
    config: {
      brightness: 0.95,
      contrast: 0.25,
      saturation: 0.85,
      gamma: 1.15,
      hue: 15,
      tint: { r: 255, g: 248, b: 240 }
    },
    cssFilter: 'brightness(0.95) contrast(1.25) saturate(0.85) hue-rotate(15deg)'
  },
  'realistic-portrait': {
    id: 'realistic-portrait',
    name: 'å†™å®äººåƒ',
    category: 'portrait',
    description: 'ä¿ç•™çœŸå®è‰²å½©å’Œç»†èŠ‚ï¼Œçªå‡ºçš®è‚¤é€æ˜åº¦å’Œçº¹ç†',
    config: {
      brightness: 1.02,
      contrast: 0.1,
      saturation: 1.05,
      gamma: 1.0,
      hue: 0
    },
    cssFilter: 'brightness(1.02) contrast(1.1) saturate(1.05)'
  },
  'warm-portrait': {
    id: 'warm-portrait',
    name: 'æ¸©æš–äººåƒ',
    category: 'portrait',
    description: 'æ¸©æš–çš„è‰²è°ƒï¼Œé€‚åˆäººåƒå’Œå®¤å†…æ‹æ‘„',
    config: {
      brightness: 1.05,
      saturation: 1.1,
      gamma: 1.05,
      hue: 10,
      tint: { r: 255, g: 250, b: 245 }
    },
    cssFilter: 'brightness(1.05) saturate(1.1) hue-rotate(10deg)'
  },
  
  // ========== é£æ™¯é£æ ¼ ==========
  'natural-landscape': {
    id: 'natural-landscape',
    name: 'è‡ªç„¶é£å…‰',
    category: 'landscape',
    description: 'ä¿ç•™è‡ªç„¶è‰²å½©å¹³è¡¡ï¼Œå¼ºè°ƒåŸå§‹è´¨æ„Ÿ',
    config: {
      brightness: 1.0,
      contrast: 0.1,
      saturation: 1.15,
      gamma: 1.0,
      hue: 0
    },
    cssFilter: 'brightness(1.0) contrast(1.1) saturate(1.15)'
  },
  'cinematic-landscape': {
    id: 'cinematic-landscape',
    name: 'ç”µå½±æ„Ÿé£å…‰',
    category: 'landscape',
    description: 'ç”µå½±çº§è°ƒè‰²ï¼Œç‹¬ç‰¹çš„è‰²è°ƒå’Œæƒ…ç»ªåŒ–æ°›å›´',
    config: {
      brightness: 0.95,
      contrast: 0.3,
      saturation: 0.9,
      gamma: 1.2,
      hue: 5,
      tint: { r: 255, g: 250, b: 245 }
    },
    cssFilter: 'brightness(0.95) contrast(1.3) saturate(0.9) hue-rotate(5deg)'
  },
  'film-landscape': {
    id: 'film-landscape',
    name: 'èƒ¶ç‰‡é£å…‰',
    category: 'landscape',
    description: 'æ¨¡æ‹Ÿ35mmèƒ¶ç‰‡å¤å¤ç¾å­¦ï¼Œå…·æœ‰é¢—ç²’çº¹ç†æ„Ÿ',
    config: {
      brightness: 1.0,
      contrast: 0.2,
      saturation: 1.1,
      gamma: 1.1,
      hue: 8,
      tint: { r: 255, g: 252, b: 248 }
    },
    cssFilter: 'brightness(1.0) contrast(1.2) saturate(1.1) hue-rotate(8deg)'
  },
  'vibrant-landscape': {
    id: 'vibrant-landscape',
    name: 'é²œè‰³é£å…‰',
    category: 'landscape',
    description: 'å¢å¼ºè‰²å½©é¥±å’Œåº¦ï¼Œæ˜äº®é²œè‰³',
    config: {
      brightness: 1.1,
      saturation: 1.3,
      contrast: 0.1,
      gamma: 1.0
    },
    cssFilter: 'brightness(1.1) saturate(1.3) contrast(1.1)'
  },
  'golden-hour': {
    id: 'golden-hour',
    name: 'é»„é‡‘æ—¶åˆ»',
    category: 'landscape',
    description: 'æš–è‰²è°ƒå’Œé‡‘è‰²è‰²è°ƒï¼Œé€‚åˆæ—¥è½å’Œé»„é‡‘æ—¶æ®µ',
    config: {
      brightness: 1.05,
      saturation: 1.2,
      gamma: 1.05,
      hue: 20,
      tint: { r: 255, g: 245, b: 235 }
    },
    cssFilter: 'brightness(1.05) saturate(1.2) hue-rotate(20deg)'
  },
  
  // ========== é€šç”¨é£æ ¼ ==========
  'black-white': {
    id: 'black-white',
    name: 'é»‘ç™½',
    category: 'general',
    description: 'ç»å…¸é»‘ç™½æ•ˆæœ',
    config: {
      saturation: 0,
      contrast: 0.2,
      brightness: 1.0
    },
    cssFilter: 'grayscale(1) contrast(1.2)'
  },
  'vintage': {
    id: 'vintage',
    name: 'å¤å¤',
    category: 'general',
    description: 'æ¸©æš–çš„å¤å¤è‰²è°ƒï¼Œå¢å¼ºå¯¹æ¯”åº¦å’Œé¥±å’Œåº¦',
    config: {
      brightness: 1.05,
      contrast: 0.15,
      saturation: 1.1,
      hue: 15,
      gamma: 1.1
    },
    cssFilter: 'brightness(1.05) contrast(1.15) saturate(1.1) hue-rotate(15deg)'
  },
  'cool': {
    id: 'cool',
    name: 'å†·è‰²è°ƒ',
    category: 'general',
    description: 'æ¸…çˆ½çš„å†·è‰²è°ƒ',
    config: {
      brightness: 1.0,
      saturation: 0.9,
      hue: -10
    },
    cssFilter: 'brightness(1.0) saturate(0.9) hue-rotate(-10deg)'
  }
};

/**
 * æŒ‰åˆ†ç±»è·å–é¢„è®¾
 */
export function getPresetsByCategory(category: 'portrait' | 'landscape' | 'general'): StylePreset[] {
  return Object.values(STYLE_PRESETS).filter(preset => preset.category === category);
}

/**
 * è·å–æ‰€æœ‰é¢„è®¾ï¼ˆæŒ‰åˆ†ç±»æ’åºï¼‰
 */
export function getAllPresets(): StylePreset[] {
  const order = ['portrait', 'landscape', 'general'];
  return Object.values(STYLE_PRESETS).sort((a, b) => {
    return order.indexOf(a.category) - order.indexOf(b.category);
  });
}
```

#### 2. PhotoProcessor æ‰©å±• (`services/worker/src/processor.ts`)

```typescript
import { STYLE_PRESETS, type StylePresetConfig } from '../lib/style-presets';

class PhotoProcessor {
  /**
   * åº”ç”¨é£æ ¼é¢„è®¾ï¼ˆç®€åŒ–ç‰ˆï¼Œåªæ”¯æŒé¢„è®¾é€‰æ‹©ï¼‰
   */
  private applyStylePreset(
    image: sharp.Sharp,
    presetId: string | null | undefined
  ): sharp.Sharp {
    // å¦‚æœæœªé€‰æ‹©é¢„è®¾æˆ–é€‰æ‹©"æ— é£æ ¼"ï¼Œç›´æ¥è¿”å›åŸå›¾
    if (!presetId || presetId === 'none') {
      return image;
    }

    // è·å–é¢„è®¾é…ç½®
    const preset = STYLE_PRESETS[presetId];
    if (!preset) {
      console.warn(`[StylePreset] Unknown preset: ${presetId}, skipping`);
      return image;
    }

    const config = preset.config;
    let processedImage = image.clone();

    // åº”ç”¨ modulateï¼ˆäº®åº¦ã€é¥±å’Œåº¦ã€è‰²ç›¸ï¼‰
    if (config.brightness !== undefined || 
        config.saturation !== undefined || 
        config.hue !== undefined) {
      processedImage = processedImage.modulate({
        brightness: config.brightness ?? 1.0,
        saturation: config.saturation ?? 1.0,
        hue: config.hue ?? 0,
      });
    }

    // åº”ç”¨å¯¹æ¯”åº¦
    if (config.contrast !== undefined && config.contrast !== 0) {
      processedImage = processedImage.contrast(config.contrast);
    }

    // åº”ç”¨ä¼½é©¬æ ¡æ­£
    if (config.gamma !== undefined && config.gamma !== 1.0) {
      processedImage = processedImage.gamma(config.gamma);
    }

    // åº”ç”¨è‰²è°ƒå åŠ ï¼ˆç”¨äºè‰²æ¸©æ¨¡æ‹Ÿï¼‰
    if (config.tint) {
      processedImage = processedImage.tint(config.tint);
    }

    return processedImage;
  }

  async process(
    watermarkConfig?: WatermarkConfig,
    manualRotation?: number | null,
    stylePresetId?: string | null  // ç®€åŒ–ä¸ºåªä¼ é¢„è®¾ ID
  ): Promise<ProcessedResult> {
    // ... ç°æœ‰ä»£ç  ...

    // åº”ç”¨æ—‹è½¬
    let rotatedImage: sharp.Sharp;
    if (manualRotation !== null && manualRotation !== undefined) {
      rotatedImage = this.image.clone().rotate().rotate(manualRotation);
    } else {
      rotatedImage = this.image.clone().rotate();
    }

    // åº”ç”¨é£æ ¼é¢„è®¾ï¼ˆåœ¨æ—‹è½¬ä¹‹åï¼Œæ°´å°ä¹‹å‰ï¼‰
    rotatedImage = this.applyStylePreset(rotatedImage, stylePresetId);

    // ... åç»­å¤„ç†ï¼ˆç”Ÿæˆç¼©ç•¥å›¾ã€é¢„è§ˆå›¾ã€æ°´å°ç­‰ï¼‰...
  }
}

  async process(
    watermarkConfig?: WatermarkConfig,
    manualRotation?: number | null,
    styleConfig?: StylePresetConfig | null
  ): Promise<ProcessedResult> {
    // ... ç°æœ‰ä»£ç  ...

    // åº”ç”¨æ—‹è½¬
    let rotatedImage: sharp.Sharp;
    if (manualRotation !== null && manualRotation !== undefined) {
      rotatedImage = this.image.clone().rotate().rotate(manualRotation);
    } else {
      rotatedImage = this.image.clone().rotate();
    }

    // åº”ç”¨é£æ ¼é¢„è®¾ï¼ˆåœ¨æ—‹è½¬ä¹‹åï¼Œæ°´å°ä¹‹å‰ï¼‰
    rotatedImage = this.applyStylePreset(rotatedImage, styleConfig);

    // ... åç»­å¤„ç†ï¼ˆç”Ÿæˆç¼©ç•¥å›¾ã€é¢„è§ˆå›¾ã€æ°´å°ç­‰ï¼‰...
  }
}
```

#### 3. Worker é›†æˆ (`services/worker/src/index.ts`)

```typescript
// åœ¨ Worker å¤„ç†é€»è¾‘ä¸­
const album = await getAlbum(albumId);

// è¯»å–é£æ ¼é¢„è®¾ IDï¼ˆç®€åŒ–ï¼šåªå­˜å‚¨é¢„è®¾ IDï¼‰
const colorGrading = album?.color_grading as { preset?: string } | null;
const stylePresetId = colorGrading?.preset || null;

// ä¼ é€’ç»™ PhotoProcessorï¼ˆåªä¼ é¢„è®¾ IDï¼‰
const processor = new PhotoProcessor(processingBuffer);
const result = await processor.process(watermarkConfig, photoRotation, stylePresetId);
```

---

## API è®¾è®¡

### 1. è·å–é£æ ¼é¢„è®¾åˆ—è¡¨

```
GET /api/admin/style-presets
```

**å“åº”ï¼š**
```json
{
  "presets": [
    {
      "id": "vintage",
      "name": "å¤å¤",
      "description": "æ¸©æš–çš„å¤å¤è‰²è°ƒ",
      "cssFilter": "brightness(1.05) contrast(1.15) saturate(1.1) hue-rotate(15deg)"
    },
    ...
  ]
}
```

### 2. æ›´æ–°ç›¸å†Œé£æ ¼

```
PATCH /api/admin/albums/[id]
```

**è¯·æ±‚ä½“ï¼š**
```json
{
  "color_grading": {
    "preset": "japanese-fresh"  // é¢„è®¾ ID
  }
}
```

**ç§»é™¤é£æ ¼ï¼š**
```json
{
  "color_grading": null
}
```

### 3. é¢„è§ˆè°ƒè‰²æ•ˆæœï¼ˆå±€éƒ¨æ¸²æŸ“ï¼‰

```
POST /api/admin/albums/[id]/preview-color-grading
```

**è¯·æ±‚ä½“ï¼š**
```json
{
  "color_grading": {
    "preset": "vintage",
    "basic": { ... },
    "tone": { ... },
    "color": { ... }
  },
  "sample_count": 3  // å¯é€‰ï¼Œé»˜è®¤ 3ï¼Œå¤„ç†å‰ N å¼ ç…§ç‰‡ä½œä¸ºé¢„è§ˆ
}
```

**å“åº”ï¼š**
```json
{
  "preview_images": [
    {
      "photo_id": "uuid",
      "preview_url": "https://...",
      "thumbnail_url": "https://..."
    },
    ...
  ]
}
```

**ç”¨é€”ï¼š** åœ¨å¯åŠ¨å…¨é‡é‡æ–°å¤„ç†å‰ï¼Œå…ˆå¤„ç†æ ·æœ¬ç…§ç‰‡è®©ç”¨æˆ·é¢„è§ˆæ•ˆæœã€‚

### 4. é‡æ–°å¤„ç†ç›¸å†Œç…§ç‰‡ï¼ˆåº”ç”¨æ–°è°ƒè‰²ï¼‰

```
POST /api/admin/albums/[id]/reprocess
```

**è¯·æ±‚ä½“ï¼š**
```json
{
  "apply_color_grading": true  // å¯é€‰ï¼Œé»˜è®¤ true
}
```

**å“åº”ï¼š**
```json
{
  "job_id": "uuid",
  "total_photos": 25,
  "estimated_time": "2-3 åˆ†é’Ÿ"
}
```

---

## å‰ç«¯è®¾è®¡

### 1. ç®¡ç†å‘˜æ“ä½œæµç¨‹

#### åœºæ™¯ä¸€ï¼šåˆ›å»ºæ–°ç›¸å†Œæ—¶é€‰æ‹©é£æ ¼ï¼ˆå¯é€‰ï¼‰

**æ­¥éª¤ï¼š**
1. ç®¡ç†å‘˜ç‚¹å‡»"åˆ›å»ºç›¸å†Œ"æŒ‰é’®
2. å¡«å†™åŸºæœ¬ä¿¡æ¯ï¼ˆæ ‡é¢˜ã€æè¿°ç­‰ï¼‰
3. **å¯é€‰**ï¼šåœ¨"è°ƒè‰²è®¾ç½®"éƒ¨åˆ†é€‰æ‹©é£æ ¼
   - é»˜è®¤ï¼šæ— é£æ ¼ï¼ˆä¸é€‰æ‹©ï¼‰
   - å¯é€‰ï¼šé€‰æ‹©é¢„è®¾é£æ ¼ï¼ˆå¦‚"å¤å¤"ã€"ç”µå½±æ„Ÿ"ï¼‰
   - å¯é€‰ï¼šå±•å¼€"ä¸“ä¸šæ¨¡å¼"ï¼Œæ‰‹åŠ¨è°ƒæ•´å‚æ•°
4. å®æ—¶é¢„è§ˆæ•ˆæœï¼ˆä½¿ç”¨ç¤ºä¾‹å›¾ç‰‡ + CSS æ»¤é•œï¼‰
5. ç‚¹å‡»"åˆ›å»ºç›¸å†Œ"
6. å¦‚æœé€‰æ‹©äº†é£æ ¼ï¼Œåç»­ä¸Šä¼ çš„ç…§ç‰‡ä¼šè‡ªåŠ¨åº”ç”¨è°ƒè‰²é…ç½®
7. å¦‚æœæ²¡æœ‰é€‰æ‹©é£æ ¼ï¼Œç›¸å†Œä¿æŒåŸå§‹è‰²å½©ï¼ˆ`color_grading = null`ï¼‰

**UI è®¾è®¡ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ–°å»ºç›¸å†Œ                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åŸºæœ¬ä¿¡æ¯                              â”‚
â”‚ [æ ‡é¢˜è¾“å…¥æ¡†]                         â”‚
â”‚ [æè¿°è¾“å…¥æ¡†]                         â”‚
â”‚                                      â”‚
â”‚ è°ƒè‰²è®¾ç½®ï¼ˆå¯é€‰ï¼‰â­                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ â—‹ æ— é£æ ¼ï¼ˆé»˜è®¤ï¼‰                  â”‚ â”‚
â”‚ â”‚ â—‹ å¤å¤ [é¢„è§ˆå›¾]                   â”‚ â”‚
â”‚ â”‚ â—‹ ç”µå½±æ„Ÿ [é¢„è§ˆå›¾]                 â”‚ â”‚
â”‚ â”‚ â—‹ é²œè‰³ [é¢„è§ˆå›¾]                   â”‚ â”‚
â”‚ â”‚ ...                               â”‚ â”‚
â”‚ â”‚                                    â”‚ â”‚
â”‚ â”‚ [å±•å¼€ä¸“ä¸šæ¨¡å¼ â–¼]                   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                      â”‚
â”‚ [åˆ›å»ºç›¸å†Œ] [å–æ¶ˆ]                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®ç‚¹ï¼š**
- âœ… é£æ ¼é€‰æ‹©æ˜¯**å¯é€‰çš„**ï¼Œå¯ä»¥ä¸é€‰æ‹©
- âœ… é»˜è®¤é€‰æ‹©"æ— é£æ ¼"
- âœ… é€‰æ‹©é£æ ¼åå¯ä»¥é¢„è§ˆæ•ˆæœ
- âœ… åˆ›å»ºåå¯ä»¥éšæ—¶åœ¨è®¾ç½®é¡µé¢åˆ‡æ¢é£æ ¼

#### åœºæ™¯äºŒï¼šä¸ºå·²æœ‰ç›¸å†Œè®¾ç½®/ä¿®æ”¹è°ƒè‰²

**æ­¥éª¤ï¼š**
1. ç®¡ç†å‘˜è¿›å…¥ç›¸å†Œè¯¦æƒ…é¡µ
2. ç‚¹å‡»"è®¾ç½®"æŒ‰é’®ï¼ˆæˆ–è®¿é—® `/admin/albums/[id]/settings`ï¼‰
3. åœ¨è®¾ç½®é¡µé¢æ‰¾åˆ°"è°ƒè‰²è®¾ç½®"éƒ¨åˆ†
4. é€‰æ‹©é¢„è®¾æˆ–è‡ªå®šä¹‰å‚æ•°
5. å®æ—¶é¢„è§ˆæ•ˆæœ
6. ç‚¹å‡»"ä¿å­˜è®¾ç½®"
7. **é‡è¦æç¤º**ï¼šç³»ç»Ÿä¼šè¯¢é—®æ˜¯å¦é‡æ–°å¤„ç†å·²ä¸Šä¼ çš„ç…§ç‰‡
   - é€‰æ‹©"æ˜¯"ï¼šåå°å¼‚æ­¥é‡æ–°å¤„ç†æ‰€æœ‰ç…§ç‰‡ï¼ˆå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼‰
   - é€‰æ‹©"å¦"ï¼šä»…å¯¹æ–°ä¸Šä¼ çš„ç…§ç‰‡ç”Ÿæ•ˆ

#### åœºæ™¯ä¸‰ï¼šåŸºäºé¢„è®¾å¾®è°ƒ

**æ­¥éª¤ï¼š**
1. é€‰æ‹©é¢„è®¾é£æ ¼ï¼ˆå¦‚"å¤å¤"ï¼‰
2. ç‚¹å‡»"è‡ªå®šä¹‰"æŒ‰é’®ï¼Œå±•å¼€è¯¦ç»†å‚æ•°
3. åœ¨é¢„è®¾åŸºç¡€ä¸Šå¾®è°ƒå‚æ•°ï¼ˆå¦‚äº®åº¦ +5%ã€å¯¹æ¯”åº¦ +10%ï¼‰
4. å®æ—¶é¢„è§ˆæ•ˆæœ
5. ä¿å­˜è®¾ç½®

### 2. è°ƒè‰²è®¾ç½®ç•Œé¢è®¾è®¡

**ä½ç½®ï¼š** `apps/web/src/components/admin/album-settings-form.tsx`ï¼ˆé›†æˆåˆ°ç›¸å†Œè®¾ç½®è¡¨å•ï¼‰

**UI å¸ƒå±€ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç›¸å†Œè®¾ç½®                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚ åŸºæœ¬ä¿¡æ¯                                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ æ ‡é¢˜ã€æè¿°ã€æ—¥æœŸç­‰...                                â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                          â”‚
â”‚ è°ƒè‰²è®¾ç½® â­ æ–°å¢                                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                                                     â”‚ â”‚
â”‚ â”‚ ã€äººç‰©é£æ ¼ã€‘                                        â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚ â”‚ â”‚æ—¥ç³»å°æ¸…æ–°â”‚ â”‚èƒ¶ç‰‡äººåƒ  â”‚ â”‚ç”µå½±æ„Ÿäººåƒâ”‚ â”‚å†™å®äººåƒ  â”‚ â”‚ â”‚
â”‚ â”‚ â”‚  [é¢„è§ˆ]  â”‚ â”‚  [é¢„è§ˆ]  â”‚ â”‚  [é¢„è§ˆ]  â”‚ â”‚  [é¢„è§ˆ]  â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚ â”‚
â”‚ â”‚ â”‚æ¸©æš–äººåƒ  â”‚                                        â”‚ â”‚
â”‚ â”‚ â”‚  [é¢„è§ˆ]  â”‚                                        â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚ â”‚
â”‚ â”‚                                                     â”‚ â”‚
â”‚ â”‚ ã€é£æ™¯é£æ ¼ã€‘                                        â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚ â”‚ â”‚è‡ªç„¶é£å…‰  â”‚ â”‚ç”µå½±æ„Ÿé£å…‰â”‚ â”‚èƒ¶ç‰‡é£å…‰  â”‚ â”‚é»„é‡‘æ—¶åˆ»  â”‚ â”‚ â”‚
â”‚ â”‚ â”‚  [é¢„è§ˆ]  â”‚ â”‚  [é¢„è§ˆ]  â”‚ â”‚  [é¢„è§ˆ]  â”‚ â”‚  [é¢„è§ˆ]  â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚ â”‚
â”‚ â”‚ â”‚é²œè‰³é£å…‰  â”‚                                        â”‚ â”‚
â”‚ â”‚ â”‚  [é¢„è§ˆ]  â”‚                                        â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚ â”‚
â”‚ â”‚                                                     â”‚ â”‚
â”‚ â”‚ ã€é€šç”¨é£æ ¼ã€‘                                        â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚ â”‚
â”‚ â”‚ â”‚  é»‘ç™½    â”‚ â”‚  å¤å¤    â”‚ â”‚ å†·è‰²è°ƒ   â”‚            â”‚ â”‚
â”‚ â”‚ â”‚  [é¢„è§ˆ]  â”‚ â”‚  [é¢„è§ˆ]  â”‚ â”‚  [é¢„è§ˆ]  â”‚            â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚ â”‚
â”‚ â”‚                                                     â”‚ â”‚
â”‚ â”‚ ã€å®æ—¶é¢„è§ˆã€‘                                        â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚ â”‚
â”‚ â”‚ â”‚  åŸå›¾      â”‚  â”‚  è°ƒè‰²å    â”‚                   â”‚ â”‚
â”‚ â”‚ â”‚  [å›¾ç‰‡]    â”‚  â”‚  [å›¾ç‰‡]    â”‚                   â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚ â”‚
â”‚ â”‚                                                     â”‚ â”‚
â”‚ â”‚ å½“å‰é€‰æ‹©ï¼šæ—¥ç³»å°æ¸…æ–°                                â”‚ â”‚
â”‚ â”‚                                                     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                          â”‚
â”‚ å…¶ä»–è®¾ç½®ï¼ˆæ°´å°ã€å¸ƒå±€ç­‰ï¼‰...                              â”‚
â”‚                                                          â”‚
â”‚ [ä¿å­˜è®¾ç½®] [å–æ¶ˆ]                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. è°ƒè‰²ç»„ä»¶è®¾è®¡

**ç»„ä»¶ï¼š** `apps/web/src/components/admin/color-grading-panel.tsx`

**åŠŸèƒ½ç‰¹æ€§ï¼ˆç®€åŒ–ç‰ˆï¼‰ï¼š**
- **é¢„è®¾é€‰æ‹©å™¨**ï¼šæŒ‰åˆ†ç±»å±•ç¤ºï¼ˆäººç‰©/é£æ™¯/é€šç”¨ï¼‰ï¼Œç½‘æ ¼å¸ƒå±€
- **é¢„è®¾å¡ç‰‡**ï¼šæ˜¾ç¤ºé¢„è§ˆå›¾ã€åç§°ã€æè¿°
- **å®æ—¶é¢„è§ˆ**ï¼šä½¿ç”¨ CSS æ»¤é•œï¼Œæ— éœ€é‡æ–°å¤„ç†å›¾ç‰‡
- **é•¿æŒ‰å¯¹æ¯”**ï¼šé•¿æŒ‰é¢„è§ˆå›¾å¯æŸ¥çœ‹åŸå›¾å¯¹æ¯”
- **ä¿å­˜æç¤º**ï¼šå¦‚æœç›¸å†Œå·²æœ‰ç…§ç‰‡ï¼Œæç¤ºæ˜¯å¦éœ€è¦é‡æ–°å¤„ç†

**ä»£ç ç»“æ„ï¼ˆç®€åŒ–ç‰ˆï¼‰ï¼š**
```tsx
interface StylePresetSelectorProps {
  value: string | null;  // é¢„è®¾ ID æˆ– nullï¼ˆæ— é£æ ¼ï¼‰
  onChange: (presetId: string | null) => void;
  previewImage?: string; // ç”¨äºé¢„è§ˆçš„ç¤ºä¾‹å›¾ç‰‡
}

export function StylePresetSelector({ value, onChange, previewImage }: StylePresetSelectorProps) {
  const portraitPresets = getPresetsByCategory('portrait');
  const landscapePresets = getPresetsByCategory('landscape');
  const generalPresets = getPresetsByCategory('general');
  
  // é€‰æ‹©é¢„è®¾
  const handlePresetSelect = (presetId: string | null) => {
    onChange(presetId);
  };
  
  // ç”Ÿæˆ CSS æ»¤é•œç”¨äºé¢„è§ˆ
  const cssFilter = useMemo(() => {
    if (!value) return 'none';
    const preset = STYLE_PRESETS[value];
    return preset?.cssFilter || 'none';
  }, [value]);
  
  return (
    <div className="style-preset-selector">
      {/* äººç‰©é£æ ¼ */}
      <PresetCategory 
        title="äººç‰©é£æ ¼"
        presets={portraitPresets}
        selected={value}
        onSelect={handlePresetSelect}
      />
      
      {/* é£æ™¯é£æ ¼ */}
      <PresetCategory 
        title="é£æ™¯é£æ ¼"
        presets={landscapePresets}
        selected={value}
        onSelect={handlePresetSelect}
      />
      
      {/* é€šç”¨é£æ ¼ */}
      <PresetCategory 
        title="é€šç”¨é£æ ¼"
        presets={generalPresets}
        selected={value}
        onSelect={handlePresetSelect}
      />
      
      {/* å®æ—¶é¢„è§ˆ */}
      {previewImage && (
        <PreviewImage 
          src={previewImage}
          filter={cssFilter}
          showOriginalOnHold={true}  // é•¿æŒ‰å¯¹æ¯”åŸå›¾
        />
      )}
    </div>
  );
}
```

### 4. ä¿å­˜å’Œé‡æ–°å¤„ç†æµç¨‹

**ä¿å­˜è°ƒè‰²é…ç½®ï¼š**
```typescript
// 1. ç”¨æˆ·ç‚¹å‡»"ä¿å­˜è®¾ç½®"
const handleSave = async () => {
  // 2. å‡†å¤‡é…ç½®ï¼ˆå¦‚æœé€‰æ‹©"æ— é£æ ¼"ï¼Œä¼  nullï¼‰
  const colorGradingConfig = selectedPreset === 'none' 
    ? null 
    : colorGradingConfig;
  
  // 3. è°ƒç”¨ API æ›´æ–°ç›¸å†Œé…ç½®
  const response = await fetch(`/api/admin/albums/${albumId}`, {
    method: 'PATCH',
    body: JSON.stringify({
      color_grading: colorGradingConfig  // å¯ä»¥æ˜¯ nullï¼ˆç§»é™¤é£æ ¼ï¼‰
    })
  });
  
  // 4. å¦‚æœç›¸å†Œå·²æœ‰ç…§ç‰‡ï¼Œè¯¢é—®æ˜¯å¦é‡æ–°å¤„ç†
  if (album.photo_count > 0) {
    const shouldReprocess = await showConfirmDialog({
      title: colorGradingConfig ? 'åº”ç”¨æ–°é£æ ¼' : 'ç§»é™¤é£æ ¼',
      message: colorGradingConfig
        ? `ç›¸å†Œä¸­æœ‰ ${album.photo_count} å¼ ç…§ç‰‡ï¼Œæ˜¯å¦é‡æ–°å¤„ç†ä»¥åº”ç”¨æ–°çš„è°ƒè‰²é…ç½®ï¼Ÿ`
        : `ç›¸å†Œä¸­æœ‰ ${album.photo_count} å¼ ç…§ç‰‡ï¼Œæ˜¯å¦é‡æ–°å¤„ç†ä»¥ç§»é™¤è°ƒè‰²æ•ˆæœï¼Ÿ`,
      confirmText: 'é‡æ–°å¤„ç†',
      cancelText: 'ä»…å¯¹æ–°ç…§ç‰‡ç”Ÿæ•ˆ'
    });
    
    if (shouldReprocess) {
      // 5. è§¦å‘é‡æ–°å¤„ç†ä»»åŠ¡
      await fetch(`/api/admin/albums/${albumId}/reprocess`, {
        method: 'POST',
        body: JSON.stringify({ apply_color_grading: true })
      });
      
      showSuccess(
        colorGradingConfig 
          ? 'è°ƒè‰²é…ç½®å·²ä¿å­˜ï¼Œç…§ç‰‡æ­£åœ¨åå°é‡æ–°å¤„ç†...'
          : 'é£æ ¼å·²ç§»é™¤ï¼Œç…§ç‰‡æ­£åœ¨åå°é‡æ–°å¤„ç†...'
      );
    } else {
      showSuccess(
        colorGradingConfig
          ? 'è°ƒè‰²é…ç½®å·²ä¿å­˜ï¼Œå°†åº”ç”¨äºæ–°ä¸Šä¼ çš„ç…§ç‰‡'
          : 'é£æ ¼å·²ç§»é™¤ï¼Œæ–°ä¸Šä¼ çš„ç…§ç‰‡å°†ä¿æŒåŸå§‹è‰²å½©'
      );
    }
  } else {
    showSuccess(
      colorGradingConfig 
        ? 'è°ƒè‰²é…ç½®å·²ä¿å­˜'
        : 'é£æ ¼å·²ç§»é™¤'
    );
  }
};
```

**é‡æ–°å¤„ç†æç¤ºç•Œé¢ï¼š**

**åœºæ™¯ Aï¼šåº”ç”¨æ–°é£æ ¼**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åº”ç”¨æ–°é£æ ¼ï¼Ÿ                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚ ç›¸å†Œä¸­æœ‰ 25 å¼ ç…§ç‰‡                    â”‚
â”‚ å½“å‰é£æ ¼ï¼šå¤å¤                        â”‚
â”‚ æ–°é£æ ¼ï¼šç”µå½±æ„Ÿ                        â”‚
â”‚                                      â”‚
â”‚ é€‰æ‹©é‡æ–°å¤„ç†ï¼š                        â”‚
â”‚ â€¢ æ‰€æœ‰ç…§ç‰‡å°†åº”ç”¨æ–°çš„è°ƒè‰²é…ç½®           â”‚
â”‚ â€¢ å¤„ç†æ—¶é—´çº¦ 1-3 åˆ†é’Ÿ                 â”‚
â”‚ â€¢ å¯åœ¨åå°å¼‚æ­¥å¤„ç†                    â”‚
â”‚                                      â”‚
â”‚ é€‰æ‹©ä»…å¯¹æ–°ç…§ç‰‡ç”Ÿæ•ˆï¼š                  â”‚
â”‚ â€¢ å·²ä¸Šä¼ çš„ç…§ç‰‡ä¿æŒåŸæ ·                â”‚
â”‚ â€¢ æ–°ä¸Šä¼ çš„ç…§ç‰‡ä¼šåº”ç”¨è°ƒè‰²é…ç½®           â”‚
â”‚                                      â”‚
â”‚ [é‡æ–°å¤„ç†] [ä»…å¯¹æ–°ç…§ç‰‡ç”Ÿæ•ˆ] [å–æ¶ˆ]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åœºæ™¯ Bï¼šç§»é™¤é£æ ¼**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç§»é™¤é£æ ¼ï¼Ÿ                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚ ç›¸å†Œä¸­æœ‰ 25 å¼ ç…§ç‰‡                    â”‚
â”‚ å½“å‰é£æ ¼ï¼šå¤å¤                        â”‚
â”‚                                      â”‚
â”‚ é€‰æ‹©é‡æ–°å¤„ç†ï¼š                        â”‚
â”‚ â€¢ æ‰€æœ‰ç…§ç‰‡å°†æ¢å¤åŸå§‹è‰²å½©               â”‚
â”‚ â€¢ å¤„ç†æ—¶é—´çº¦ 1-3 åˆ†é’Ÿ                 â”‚
â”‚ â€¢ å¯åœ¨åå°å¼‚æ­¥å¤„ç†                    â”‚
â”‚                                      â”‚
â”‚ é€‰æ‹©ä»…å¯¹æ–°ç…§ç‰‡ç”Ÿæ•ˆï¼š                  â”‚
â”‚ â€¢ å·²ä¸Šä¼ çš„ç…§ç‰‡ä¿æŒå½“å‰é£æ ¼             â”‚
â”‚ â€¢ æ–°ä¸Šä¼ çš„ç…§ç‰‡å°†ä¿æŒåŸå§‹è‰²å½©           â”‚
â”‚                                      â”‚
â”‚ [é‡æ–°å¤„ç†] [ä»…å¯¹æ–°ç…§ç‰‡ç”Ÿæ•ˆ] [å–æ¶ˆ]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. å‰ç«¯é¢„è§ˆå®ç°

**CSS æ»¤é•œæ˜ å°„ï¼š**

```typescript
// apps/web/src/lib/style-preset-utils.ts
export function getStylePresetCSSFilter(
  preset: StylePresetConfig | null
): string {
  if (!preset || preset.preset === 'none' || !preset.preset) {
    return 'none';
  }

  const config = preset.preset === 'custom' 
    ? preset.custom 
    : STYLE_PRESETS[preset.preset]?.config;

  if (!config) {
    return 'none';
  }

  const filters: string[] = [];

  if (config.brightness !== undefined) {
    filters.push(`brightness(${config.brightness})`);
  }
  if (config.contrast !== undefined) {
    filters.push(`contrast(${1 + config.contrast})`);
  }
  if (config.saturation !== undefined) {
    filters.push(`saturate(${config.saturation})`);
  }
  if (config.hue !== undefined) {
    filters.push(`hue-rotate(${config.hue}deg)`);
  }
  if (config.saturation === 0) {
    filters.push('grayscale(1)');
  }

  return filters.join(' ') || 'none';
}
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```tsx
<img 
  src={photo.preview_url} 
  style={{ 
    filter: getStylePresetCSSFilter(album.color_grading) 
  }} 
/>
```

**è¿›é˜¶åŠŸèƒ½ï¼šé•¿æŒ‰å¯¹æ¯”åŸå›¾**

åœ¨é¢„è§ˆé¢æ¿ä¸­å¢åŠ "é•¿æŒ‰å¯¹æ¯”åŸå›¾"åŠŸèƒ½ï¼Œæå‡è°ƒè‰²ä½“éªŒï¼š

```tsx
// apps/web/src/components/admin/color-grading-preview.tsx
export function ColorGradingPreview({ 
  imageUrl, 
  filter 
}: { 
  imageUrl: string; 
  filter: string 
}) {
  const [showOriginal, setShowOriginal] = useState(false);
  
  return (
    <div 
      className="relative"
      onMouseDown={() => setShowOriginal(true)}
      onMouseUp={() => setShowOriginal(false)}
      onMouseLeave={() => setShowOriginal(false)}
      onTouchStart={() => setShowOriginal(true)}
      onTouchEnd={() => setShowOriginal(false)}
    >
      <img 
        src={imageUrl}
        alt="è°ƒè‰²é¢„è§ˆ"
        className="w-full h-auto"
        style={{ 
          filter: showOriginal ? 'none' : filter,
          transition: 'filter 0.1s ease-out'
        }} 
      />
      {showOriginal && (
        <div className="absolute top-2 left-2 bg-black/70 text-white px-2 py-1 rounded text-sm">
          åŸå›¾
        </div>
      )}
      <div className="absolute bottom-2 right-2 bg-black/70 text-white px-2 py-1 rounded text-sm text-xs">
        é•¿æŒ‰æŸ¥çœ‹åŸå›¾
      </div>
    </div>
  );
}
```

**ä¼˜åŠ¿ï¼š**
- âœ… æå‡è°ƒè‰²ä½“éªŒï¼Œæ–¹ä¾¿å¯¹æ¯”æ•ˆæœ
- âœ… å®ç°ç®€å•ï¼Œæ— éœ€é¢å¤– API
- âœ… ç§»åŠ¨ç«¯å’Œæ¡Œé¢ç«¯éƒ½æ”¯æŒ

---

## å®ç°è®¡åˆ’

### é˜¶æ®µä¸€ï¼šæ ¸å¿ƒåŠŸèƒ½ï¼ˆMVPï¼‰

1. âœ… åˆ›å»ºé£æ ¼é¢„è®¾å®šä¹‰æ–‡ä»¶ï¼ˆ13 ä¸ªé¢„è®¾ï¼š5 äººç‰© + 5 é£æ™¯ + 3 é€šç”¨ï¼‰
2. âœ… æ‰©å±•æ•°æ®åº“ schemaï¼ˆæ·»åŠ  `color_grading` å­—æ®µï¼Œåªå­˜å‚¨é¢„è®¾ IDï¼‰
3. âœ… å®ç° `PhotoProcessor.applyStylePreset()` æ–¹æ³•ï¼ˆç®€åŒ–ç‰ˆï¼‰
4. âœ… Worker é›†æˆé£æ ¼å¤„ç†ï¼ˆè¯»å–é¢„è®¾ IDï¼Œä¼ é€’ç»™ Processorï¼‰
5. âœ… APIï¼šè·å–é¢„è®¾åˆ—è¡¨ã€æ›´æ–°ç›¸å†Œé£æ ¼

### é˜¶æ®µäºŒï¼šå‰ç«¯ç•Œé¢

6. âœ… åˆ›å»ºé£æ ¼é€‰æ‹©å™¨ç»„ä»¶ï¼ˆæŒ‰åˆ†ç±»å±•ç¤ºï¼‰
7. âœ… åœ¨åˆ›å»ºç›¸å†Œå¯¹è¯æ¡†é›†æˆï¼ˆå¯é€‰ï¼‰
8. âœ… åœ¨ç›¸å†Œè®¾ç½®é¡µé¢é›†æˆ
9. âœ… å®ç° CSS æ»¤é•œé¢„è§ˆ
10. âœ… é•¿æŒ‰å¯¹æ¯”åŸå›¾åŠŸèƒ½

### é˜¶æ®µä¸‰ï¼šä¼˜åŒ–å’Œæµ‹è¯•

11. â³ æ‰¹é‡é‡æ–°å¤„ç†åŠŸèƒ½
12. â³ JSON Schema æ ¡éªŒï¼ˆä¸‰å±‚é˜²æŠ¤ï¼‰
13. â³ æ€§èƒ½æµ‹è¯•å’Œä¼˜åŒ–
14. â³ å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
15. â³ æ–‡æ¡£æ›´æ–°

---

## æ€§èƒ½è€ƒè™‘

### å¤„ç†æ—¶é—´å½±å“

- **åŸºå‡†**ï¼šå½“å‰å›¾ç‰‡å¤„ç†æ—¶é—´çº¦ 500-2000msï¼ˆå–å†³äºå›¾ç‰‡å¤§å°ï¼‰
- **é¢„æœŸå¢åŠ **ï¼šé£æ ¼å¤„ç†é¢„è®¡å¢åŠ  50-200msï¼ˆ< 20%ï¼‰
- **ä¼˜åŒ–æªæ–½**ï¼š
  - é£æ ¼å¤„ç†åœ¨å†…å­˜ä¸­è¿›è¡Œï¼Œæ— éœ€é¢å¤– I/O
  - å¤ç”¨ Sharp pipelineï¼Œå‡å°‘ clone æ“ä½œ
  - å¹¶è¡Œå¤„ç†å¤šä¸ªæ“ä½œï¼ˆmodulateã€contrast ç­‰ï¼‰

### å­˜å‚¨ç©ºé—´

- **å½±å“**ï¼šé£æ ¼å¤„ç†ä¸æ”¹å˜å›¾ç‰‡å°ºå¯¸ï¼Œå­˜å‚¨ç©ºé—´ä¸å˜
- **è€ƒè™‘**ï¼šå¦‚æœæœªæ¥æ”¯æŒåŸå›¾é£æ ¼å¤„ç†ï¼Œéœ€è¦é¢å¤–å­˜å‚¨ç©ºé—´

### å‰ç«¯æ€§èƒ½

- **CSS æ»¤é•œ**ï¼šç°ä»£æµè§ˆå™¨ç¡¬ä»¶åŠ é€Ÿï¼Œæ€§èƒ½è‰¯å¥½
- **é¢„è§ˆå›¾**ï¼šä½¿ç”¨ç°æœ‰é¢„è§ˆå›¾ï¼Œæ— éœ€é¢å¤–è¯·æ±‚

---

## æµ‹è¯•è®¡åˆ’

### å•å…ƒæµ‹è¯•

1. **é£æ ¼é¢„è®¾å®šä¹‰æµ‹è¯•**
   - éªŒè¯æ‰€æœ‰é¢„è®¾é…ç½®æœ‰æ•ˆ
   - éªŒè¯ CSS æ»¤é•œå­—ç¬¦ä¸²ç”Ÿæˆæ­£ç¡®

2. **PhotoProcessor æµ‹è¯•**
   - æµ‹è¯• `applyStylePreset()` æ–¹æ³•
   - éªŒè¯å„ç§é¢„è®¾æ•ˆæœ
   - æµ‹è¯•è‡ªå®šä¹‰å‚æ•°

### é›†æˆæµ‹è¯•

1. **Worker å¤„ç†æµç¨‹**
   - ä¸Šä¼ ç…§ç‰‡å¹¶åº”ç”¨é£æ ¼
   - éªŒè¯ç”Ÿæˆçš„å›¾ç‰‡åŒ…å«é£æ ¼æ•ˆæœ
   - æµ‹è¯•æœªé…ç½®é£æ ¼çš„ç›¸å†Œï¼ˆå‘åå…¼å®¹ï¼‰

2. **API æµ‹è¯•**
   - æµ‹è¯•é£æ ¼é¢„è®¾åˆ—è¡¨ API
   - æµ‹è¯•ç›¸å†Œé£æ ¼æ›´æ–° API
   - æµ‹è¯•é‡æ–°å¤„ç† API

### è§†è§‰æµ‹è¯•

1. **æ•ˆæœéªŒè¯**
   - å¯¹æ¯”åŸå§‹å›¾ç‰‡å’Œå¤„ç†åå›¾ç‰‡
   - éªŒè¯å„é¢„è®¾æ•ˆæœç¬¦åˆé¢„æœŸ
   - æµ‹è¯•æç«¯å‚æ•°å€¼

2. **æµè§ˆå™¨å…¼å®¹æ€§**
   - æµ‹è¯• CSS æ»¤é•œåœ¨å„æµè§ˆå™¨è¡¨ç°
   - éªŒè¯é¢„è§ˆæ•ˆæœä¸€è‡´æ€§

---

## åç»­ä¼˜åŒ–æ–¹å‘

### å·²è§„åˆ’åŠŸèƒ½

1. **AI é£æ ¼æ¨è**ï¼šæ ¹æ®ç…§ç‰‡å†…å®¹è‡ªåŠ¨æ¨èåˆé€‚é£æ ¼
2. **é£æ ¼å­¦ä¹ **ï¼šå…è®¸ç”¨æˆ·ä¸Šä¼ å‚è€ƒå›¾ç‰‡ï¼Œå­¦ä¹ å¹¶åº”ç”¨é£æ ¼
3. **æ‰¹é‡é£æ ¼åˆ‡æ¢**ï¼šæ”¯æŒä¸ºå¤šä¸ªç›¸å†Œæ‰¹é‡åº”ç”¨é£æ ¼
4. **é£æ ¼å¸‚åœº**ï¼šç¤¾åŒºåˆ†äº«è‡ªå®šä¹‰é£æ ¼é¢„è®¾

### è¿›é˜¶åŠŸèƒ½å»ºè®®

#### æ–¹æ¡ˆ Aï¼šé•¿æŒ‰å¯¹æ¯”åŸå›¾ï¼ˆæ¨èï¼‰

**åŠŸèƒ½æè¿°ï¼š**
åœ¨é¢„è§ˆé¢æ¿ä¸­ï¼Œé•¿æŒ‰å›¾ç‰‡å¯ä¸´æ—¶æ˜¾ç¤ºåŸå›¾ï¼Œæ¾å¼€åæ¢å¤è°ƒè‰²æ•ˆæœã€‚

**å®ç°æ–¹æ¡ˆï¼š**
```tsx
// å‰ç«¯å®ç°
<div 
  className="preview-image-container"
  onMouseDown={() => setShowOriginal(true)}
  onMouseUp={() => setShowOriginal(false)}
  onMouseLeave={() => setShowOriginal(false)}
  onTouchStart={() => setShowOriginal(true)}
  onTouchEnd={() => setShowOriginal(false)}
>
  <img 
    src={previewImage} 
    style={{ 
      filter: showOriginal ? 'none' : cssFilter 
    }} 
  />
  {showOriginal && (
    <div className="overlay-label">åŸå›¾</div>
  )}
</div>
```

**ä¼˜åŠ¿ï¼š**
- âœ… æå‡è°ƒè‰²ä½“éªŒï¼Œæ–¹ä¾¿å¯¹æ¯”æ•ˆæœ
- âœ… å®ç°ç®€å•ï¼Œæ— éœ€é¢å¤– API
- âœ… ç§»åŠ¨ç«¯å’Œæ¡Œé¢ç«¯éƒ½æ”¯æŒ

**é€‚ç”¨åœºæ™¯ï¼š**
- å¾®è°ƒå‚æ•°æ—¶å¿«é€Ÿå¯¹æ¯”
- å‘å®¢æˆ·å±•ç¤ºè°ƒè‰²æ•ˆæœ

---

#### æ–¹æ¡ˆ Bï¼šå±€éƒ¨æ¸²æŸ“é¢„è§ˆï¼ˆæ¨èï¼‰

**åŠŸèƒ½æè¿°ï¼š**
å¯¹äºå·²æœ‰ç…§ç‰‡çš„ç›¸å†Œï¼Œé‡æ–°å¤„ç†å‰å…ˆå¤„ç†å‰ 3 å¼ ç…§ç‰‡å¹¶å±•ç¤ºé¢„è§ˆï¼Œç”¨æˆ·ç¡®è®¤æ»¡æ„åå†å¯åŠ¨å…¨é‡å¼‚æ­¥ä»»åŠ¡ã€‚

**å®ç°æ–¹æ¡ˆï¼š**

**å‰ç«¯æµç¨‹ï¼š**
```typescript
// 1. ç”¨æˆ·ä¿å­˜è°ƒè‰²é…ç½®
const handleSave = async () => {
  // 2. å¦‚æœç›¸å†Œæœ‰ç…§ç‰‡ï¼Œå…ˆå¤„ç†é¢„è§ˆæ ·æœ¬
  if (album.photo_count > 0) {
    // 3. è°ƒç”¨é¢„è§ˆ APIï¼ˆå¤„ç†å‰ 3 å¼ ï¼‰
    const previewResult = await fetch(`/api/admin/albums/${albumId}/preview-color-grading`, {
      method: 'POST',
      body: JSON.stringify({ 
        color_grading: config,
        sample_count: 3  // å¤„ç†å‰ 3 å¼ 
      })
    });
    
    const { preview_images } = await previewResult.json();
    
    // 4. æ˜¾ç¤ºé¢„è§ˆå¯¹è¯æ¡†
    const confirmed = await showPreviewDialog({
      title: 'è°ƒè‰²æ•ˆæœé¢„è§ˆ',
      images: preview_images,  // æ˜¾ç¤ºå¤„ç†åçš„é¢„è§ˆå›¾
      message: `å·²å¤„ç† 3 å¼ æ ·æœ¬ç…§ç‰‡ï¼Œç¡®è®¤æ•ˆæœåå°†ç»§ç»­å¤„ç†å‰©ä½™çš„ ${album.photo_count - 3} å¼ ç…§ç‰‡`
    });
    
    if (confirmed) {
      // 5. ç”¨æˆ·ç¡®è®¤åï¼Œå¯åŠ¨å…¨é‡å¤„ç†
      await startFullReprocessing();
    }
  }
};
```

**åç«¯å®ç°ï¼š**
```typescript
// API: POST /api/admin/albums/[id]/preview-color-grading
export async function POST(request: NextRequest, { params }: RouteParams) {
  const { id } = await params;
  const { color_grading, sample_count = 3 } = await request.json();
  
  // 1. è·å–ç›¸å†Œçš„å‰ N å¼ ç…§ç‰‡
  const photos = await supabase
    .from('photos')
    .select('id, preview_key')
    .eq('album_id', id)
    .eq('status', 'completed')
    .is('deleted_at', null)
    .order('created_at', { ascending: true })
    .limit(sample_count);
  
  // 2. åˆ›å»ºä¸´æ—¶å¤„ç†ä»»åŠ¡ï¼ˆåŒæ­¥å¤„ç†ï¼‰
  const previewJobs = photos.map(photo => ({
    photoId: photo.id,
    colorGrading: color_grading,
    isPreview: true  // æ ‡è®°ä¸ºé¢„è§ˆï¼Œä¸æ›´æ–°æ•°æ®åº“
  }));
  
  // 3. å¤„ç†å¹¶è¿”å›é¢„è§ˆå›¾ URL
  const previewImages = await Promise.all(
    previewJobs.map(async (job) => {
      const processedImage = await processPhotoWithColorGrading(job);
      return {
        photoId: job.photoId,
        previewUrl: processedImage.previewUrl,
        thumbnailUrl: processedImage.thumbnailUrl
      };
    })
  );
  
  return NextResponse.json({ preview_images: previewImages });
}
```

**ä¼˜åŠ¿ï¼š**
- âœ… é¿å…å…¨é‡å¤„ç†åå‘ç°æ•ˆæœä¸æ»¡æ„
- âœ… æå‡ç”¨æˆ·ä½“éªŒï¼Œå‡å°‘ç­‰å¾…æ—¶é—´
- âœ… èŠ‚çœæœåŠ¡å™¨èµ„æº

**æ³¨æ„äº‹é¡¹ï¼š**
- é¢„è§ˆå¤„ç†æ˜¯åŒæ­¥çš„ï¼Œéœ€è¦è®¾ç½®è¶…æ—¶ï¼ˆå¦‚ 30 ç§’ï¼‰
- å¦‚æœæ ·æœ¬ç…§ç‰‡å¤„ç†å¤±è´¥ï¼Œæç¤ºç”¨æˆ·ä½†ä»å…è®¸ç»§ç»­

---

#### LUT æ”¯æŒï¼ˆæœªæ¥æ‰©å±•ï¼‰

**åŠŸèƒ½æè¿°ï¼š**
æ”¯æŒä¸Šä¼  `.cube` (LUT) æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸“ä¸šè°ƒè‰²çš„é€šç”¨æ ‡å‡†ã€‚Sharp å¯ä»¥é€šè¿‡ä¸‰ç»´æŸ¥æ‰¾è¡¨å®ç°æ¯” `modulate` æ›´ç²¾å‡†çš„æ•ˆæœã€‚

**æŠ€æœ¯æ–¹æ¡ˆï¼š**

**1. LUT æ–‡ä»¶æ ¼å¼ï¼š**
```
# LUT 3D size 64
# 64x64x64 ä¸‰ç»´æŸ¥æ‰¾è¡¨
0.000000 0.000000 0.000000
0.015625 0.000000 0.000000
...
```

**2. Sharp å®ç°ï¼š**
```typescript
// Sharp ä¸ç›´æ¥æ”¯æŒ LUTï¼Œéœ€è¦é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°ï¼š
// æ–¹æ¡ˆ Aï¼šä½¿ç”¨ Sharp çš„ pipelineColourspace + è‡ªå®šä¹‰å¤„ç†
// æ–¹æ¡ˆ Bï¼šä½¿ç”¨ imagemagickï¼ˆéœ€è¦é¢å¤–ä¾èµ–ï¼‰
// æ–¹æ¡ˆ Cï¼šä½¿ç”¨ WebGL/Canvas åœ¨æµè§ˆå™¨ç«¯å¤„ç†ï¼ˆä»…é¢„è§ˆï¼‰

// æ¨èæ–¹æ¡ˆï¼šæœåŠ¡ç«¯ä½¿ç”¨ imagemagick æˆ–è‡ªå®šä¹‰ LUT å¤„ç†åº“
import { applyLUT } from './lut-processor';

const processedImage = await applyLUT(imageBuffer, lutFile);
```

**3. æ•°æ®åº“æ‰©å±•ï¼š**
```sql
-- åœ¨ color_grading JSONB ä¸­æ·»åŠ  LUT å­—æ®µ
-- color_grading: {
--   "preset": "custom",
--   "lut": {
--     "enabled": true,
--     "file_id": "uuid",  // LUT æ–‡ä»¶å­˜å‚¨åœ¨ storage
--     "intensity": 1.0    // LUT å¼ºåº¦ï¼ˆ0.0 - 1.0ï¼‰ï¼Œæ”¯æŒæ··åˆ
--   },
--   "basic": { ... },
--   ...
-- }
```

**4. å®ç°æ­¥éª¤ï¼š**
1. åˆ›å»º LUT æ–‡ä»¶ä¸Šä¼  API
2. è§£æ `.cube` æ–‡ä»¶æ ¼å¼
3. å®ç° LUT å¤„ç†å‡½æ•°ï¼ˆä½¿ç”¨ imagemagick æˆ–è‡ªå®šä¹‰ç®—æ³•ï¼‰
4. åœ¨ PhotoProcessor ä¸­é›†æˆ LUT å¤„ç†
5. æ”¯æŒ LUT + å‚æ•°è°ƒè‰²æ··åˆï¼ˆé€šè¿‡ intensity å‚æ•°ï¼‰

**ä¼˜åŠ¿ï¼š**
- âœ… ä¸“ä¸šè°ƒè‰²æ ‡å‡†ï¼Œæ•ˆæœæ›´ç²¾å‡†
- âœ… æ”¯æŒå¯¼å…¥ä¸“ä¸šè°ƒè‰²é¢„è®¾
- âœ… å¯ä¸å‚æ•°è°ƒè‰²æ··åˆä½¿ç”¨

**æŒ‘æˆ˜ï¼š**
- âš ï¸ Sharp ä¸ç›´æ¥æ”¯æŒï¼Œéœ€è¦é¢å¤–åº“æˆ–è‡ªå®šä¹‰å®ç°
- âš ï¸ LUT æ–‡ä»¶å¤„ç†æ€§èƒ½å¼€é”€è¾ƒå¤§
- âš ï¸ éœ€è¦æ–‡ä»¶å­˜å‚¨å’Œç®¡ç†

**æ¨èä¼˜å…ˆçº§ï¼š** ä¸­ä½ï¼ˆå…ˆå®Œå–„åŸºç¡€è°ƒè‰²åŠŸèƒ½ï¼‰

---

#### JSON Schema æ ¡éªŒï¼ˆé‡è¦ï¼‰

**åŠŸèƒ½æè¿°ï¼š**
åœ¨æ•°æ®åº“å±‚é¢ä¸º `color_grading` JSONB å­—æ®µè®¾ç½® JSON Schema æ ¡éªŒï¼Œé˜²æ­¢å‰ç«¯ä¼ é”™å‚æ•°èŒƒå›´å¯¼è‡´åç«¯ Sharp æŠ¥é”™ã€‚

**å®ç°æ–¹æ¡ˆï¼š**

**1. PostgreSQL JSON Schema æ ¡éªŒï¼ˆPostgreSQL 14+ï¼‰ï¼š**
```sql
-- åˆ›å»ºæ ¡éªŒå‡½æ•°
CREATE OR REPLACE FUNCTION validate_color_grading(config JSONB)
RETURNS BOOLEAN AS $$
BEGIN
  -- æ£€æŸ¥åŸºæœ¬ç»“æ„
  IF config IS NULL THEN
    RETURN TRUE;  -- NULL æ˜¯å…è®¸çš„ï¼ˆè¡¨ç¤ºæ— è°ƒè‰²ï¼‰
  END IF;
  
  -- éªŒè¯åŸºç¡€è°ƒæ•´å‚æ•°èŒƒå›´
  IF config->'basic' IS NOT NULL THEN
    IF (config->'basic'->>'brightness')::numeric < 0.0 OR 
       (config->'basic'->>'brightness')::numeric > 2.0 THEN
      RETURN FALSE;
    END IF;
    IF (config->'basic'->>'contrast')::numeric < -1.0 OR 
       (config->'basic'->>'contrast')::numeric > 1.0 THEN
      RETURN FALSE;
    END IF;
    -- ... å…¶ä»–å‚æ•°æ ¡éªŒ
  END IF;
  
  -- éªŒè¯è‰²è°ƒè°ƒæ•´å‚æ•°èŒƒå›´
  IF config->'tone' IS NOT NULL THEN
    IF (config->'tone'->>'highlights')::numeric < -1.0 OR 
       (config->'tone'->>'highlights')::numeric > 1.0 THEN
      RETURN FALSE;
    END IF;
    -- ... å…¶ä»–å‚æ•°æ ¡éªŒ
  END IF;
  
  -- éªŒè¯è‰²å½©è°ƒæ•´å‚æ•°èŒƒå›´
  IF config->'color' IS NOT NULL THEN
    IF (config->'color'->>'temperature')::integer < -100 OR 
       (config->'color'->>'temperature')::integer > 100 THEN
      RETURN FALSE;
    END IF;
    -- ... å…¶ä»–å‚æ•°æ ¡éªŒ
  END IF;
  
  RETURN TRUE;
END;
$$ LANGUAGE plpgsql;

-- åˆ›å»º CHECK çº¦æŸ
ALTER TABLE albums 
ADD CONSTRAINT check_color_grading_valid 
CHECK (validate_color_grading(color_grading));
```

**2. åº”ç”¨å±‚æ ¡éªŒï¼ˆåŒé‡ä¿éšœï¼‰ï¼š**
```typescript
// apps/web/src/lib/color-grading-validator.ts
export function validateColorGrading(config: ColorGradingConfig): {
  valid: boolean;
  errors: string[];
} {
  const errors: string[] = [];
  
  // éªŒè¯åŸºç¡€è°ƒæ•´
  if (config.basic) {
    if (config.basic.brightness !== undefined) {
      if (config.basic.brightness < 0 || config.basic.brightness > 2) {
        errors.push('äº®åº¦å¿…é¡»åœ¨ 0.0 - 2.0 ä¹‹é—´');
      }
    }
    if (config.basic.contrast !== undefined) {
      if (config.basic.contrast < -1 || config.basic.contrast > 1) {
        errors.push('å¯¹æ¯”åº¦å¿…é¡»åœ¨ -1.0 - 1.0 ä¹‹é—´');
      }
    }
    // ... å…¶ä»–å‚æ•°
  }
  
  // éªŒè¯è‰²è°ƒè°ƒæ•´
  if (config.tone) {
    if (config.tone.highlights !== undefined) {
      if (config.tone.highlights < -1 || config.tone.highlights > 1) {
        errors.push('é«˜å…‰å¿…é¡»åœ¨ -1.0 - 1.0 ä¹‹é—´');
      }
    }
    // ... å…¶ä»–å‚æ•°
  }
  
  // éªŒè¯è‰²å½©è°ƒæ•´
  if (config.color) {
    if (config.color.temperature !== undefined) {
      if (config.color.temperature < -100 || config.color.temperature > 100) {
        errors.push('è‰²æ¸©å¿…é¡»åœ¨ -100 - 100 ä¹‹é—´');
      }
    }
    // ... å…¶ä»–å‚æ•°
  }
  
  return {
    valid: errors.length === 0,
    errors
  };
}

// åœ¨ä¿å­˜å‰æ ¡éªŒ
const validation = validateColorGrading(colorGradingConfig);
if (!validation.valid) {
  showError(`å‚æ•°æ ¡éªŒå¤±è´¥ï¼š${validation.errors.join(', ')}`);
  return;
}
```

**3. åç«¯ API æ ¡éªŒï¼š**
```typescript
// apps/web/src/app/api/admin/albums/[id]/route.ts
export async function PATCH(request: NextRequest, { params }: RouteParams) {
  const body = await request.json();
  
  // å¦‚æœåŒ…å« color_gradingï¼Œå…ˆæ ¡éªŒ
  if (body.color_grading) {
    const validation = validateColorGrading(body.color_grading);
    if (!validation.valid) {
      return NextResponse.json(
        { 
          error: { 
            code: 'VALIDATION_ERROR', 
            message: validation.errors.join('; ') 
          } 
        },
        { status: 400 }
      );
    }
  }
  
  // ... ç»§ç»­å¤„ç†
}
```

**ä¼˜åŠ¿ï¼š**
- âœ… æ•°æ®åº“å±‚é¢ä¿éšœæ•°æ®å®Œæ•´æ€§
- âœ… é˜²æ­¢æ¶æ„æˆ–é”™è¯¯æ•°æ®å¯¼è‡´ç³»ç»Ÿå´©æºƒ
- âœ… æä¾›æ¸…æ™°çš„é”™è¯¯æç¤º

**å®ç°ä¼˜å…ˆçº§ï¼š** é«˜ï¼ˆåº”è¯¥åœ¨ MVP é˜¶æ®µå®ç°ï¼‰

---

## å‚è€ƒèµ„æ–™

- [Sharp API - Colour manipulation](https://sharp.pixelplumbing.com/api-colour)
- [CSS Filter Effects](https://developer.mozilla.org/en-US/docs/Web/CSS/filter)
- [CSSgram - Instagram filters with CSS](https://github.com/una/CSSgram)
- [Pixels.js - Image filters library](https://github.com/silvia-odwyer/pixels.js)

---

## æ›´æ–°æ—¥å¿—

- **2026-01-28**: åˆå§‹ç‰ˆæœ¬ï¼Œå®ŒæˆåŠŸèƒ½è®¾è®¡å’ŒæŠ€æœ¯æ–¹æ¡ˆ
