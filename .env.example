# ===========================================
# PIS 统一环境配置
# ===========================================
#
# 使用说明:
# 1. 复制此文件为 .env.local (本地开发使用)
# 2. 根目录的 .env.local 被 apps/web 和 services/worker 共享
# 3. 生产部署时，通过平台环境变量注入，不依赖 .env 文件
#
# 配置位置说明:
#   [Vercel]     - 在 Vercel Dashboard → Settings → Environment Variables 中配置
#   [Worker]     - 在 Worker 服务部署环境中配置（Docker/独立服务器）
#   [Both]        - 两个环境都需要配置
#   [Local Only]  - 仅本地开发需要，生产环境不需要
#
# ===========================================

# ==================== 数据库配置 ====================
# 支持: supabase (推荐), postgresql, mysql
DATABASE_TYPE=supabase

# Supabase 配置 (当 DATABASE_TYPE=supabase 时使用)
# 获取方式: Supabase Dashboard -> Project Settings -> API
# [Vercel] 前端访问 Supabase
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
# [Vercel] 服务端 API Routes 使用（敏感信息，不要设置为 NEXT_PUBLIC_*）
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
# [Worker] Worker 服务使用的别名 (兼容，可与 NEXT_PUBLIC_SUPABASE_URL 相同)
SUPABASE_URL=https://your-project.supabase.co

# PostgreSQL/MySQL 配置 (当 DATABASE_TYPE=postgresql 或 mysql 时使用)
# DATABASE_URL=postgresql://user:password@host:5432/database
# DATABASE_HOST=localhost
# DATABASE_PORT=5432
# DATABASE_NAME=pis
# DATABASE_USER=postgres
# DATABASE_PASSWORD=password
# DATABASE_SSL=false

# ==================== 存储配置 ====================
# 支持: minio (默认), oss (阿里云), cos (腾讯云), s3 (AWS)
STORAGE_TYPE=minio

# MinIO 配置 (当 STORAGE_TYPE=minio 时使用)
# 获取方式: MinIO Console -> Identity -> Service Accounts
# 注意: NEXT_PUBLIC_MEDIA_URL 用于前端访问，STORAGE_ENDPOINT 用于后端连接
# 必须包含 bucket 路径（如 /pis-photos），用于构建完整的图片 URL
# [Vercel] 前端访问媒体服务器 URL
# 示例: 如果 bucket 是 pis-photos，且通过 https://media.yourdomain.com/pis-photos 访问，则配置为:
# NEXT_PUBLIC_MEDIA_URL=https://media.yourdomain.com/pis-photos
NEXT_PUBLIC_MEDIA_URL=https://media.yourdomain.com/pis-photos
# [Worker] Worker 服务连接存储后端（敏感信息，不要设置为 NEXT_PUBLIC_*）
STORAGE_ENDPOINT=localhost
STORAGE_PORT=9000
STORAGE_USE_SSL=false
STORAGE_ACCESS_KEY=your-access-key
STORAGE_SECRET_KEY=your-secret-key
STORAGE_BUCKET=pis-photos
# 存储公网 URL（用于 Worker 清除 Cloudflare 缓存）
# 重要: 必须包含 bucket 路径（如 /pis-photos），确保清除缓存时使用正确的 URL
# 示例: 如果 bucket 是 pis-photos，且通过 https://media.yourdomain.com/pis-photos 访问，则配置为:
# STORAGE_PUBLIC_URL=https://media.yourdomain.com/pis-photos
STORAGE_PUBLIC_URL=https://media.yourdomain.com

# 公网上传地址 (用于生成 presigned URL，绕过 Vercel 大小限制)
# 重要: 必须配置，否则大文件上传会失败
# 注意: 如果通过路径访问（如 /pis-photos），需要包含完整路径
# [Worker] Worker 服务生成 presigned URL 使用
MINIO_PUBLIC_URL=https://media.yourdomain.com

# 兼容旧配置 (向后兼容，可省略)
# [Worker] Worker 服务使用（如果配置了 STORAGE_* 变量，这些可省略）
MINIO_ENDPOINT_HOST=localhost
MINIO_ENDPOINT_PORT=9000
MINIO_USE_SSL=false
MINIO_ACCESS_KEY=your-access-key
MINIO_SECRET_KEY=your-secret-key
MINIO_BUCKET=pis-photos

# 阿里云 OSS 配置 (当 STORAGE_TYPE=oss 时使用)
# STORAGE_ENDPOINT=oss-cn-hangzhou.aliyuncs.com
# STORAGE_REGION=cn-hangzhou
# STORAGE_ACCESS_KEY=your-access-key-id
# STORAGE_SECRET_KEY=your-access-key-secret
# STORAGE_BUCKET=your-bucket-name
# STORAGE_PUBLIC_URL=https://your-bucket-name.oss-cn-hangzhou.aliyuncs.com

# 腾讯云 COS 配置 (当 STORAGE_TYPE=cos 时使用)
# STORAGE_ENDPOINT=cos.ap-guangzhou.myqcloud.com
# STORAGE_REGION=ap-guangzhou
# STORAGE_ACCESS_KEY=your-secret-id
# STORAGE_SECRET_KEY=your-secret-key
# STORAGE_BUCKET=your-bucket-name
# STORAGE_PUBLIC_URL=https://your-bucket-name.cos.ap-guangzhou.myqcloud.com

# AWS S3 配置 (当 STORAGE_TYPE=s3 时使用)
# STORAGE_ENDPOINT=s3.amazonaws.com
# STORAGE_REGION=us-east-1
# STORAGE_ACCESS_KEY=your-access-key-id
# STORAGE_SECRET_KEY=your-secret-access-key
# STORAGE_BUCKET=your-bucket-name
# STORAGE_PUBLIC_URL=https://your-bucket-name.s3.amazonaws.com

# ==================== Worker 服务 ====================
# Worker 服务 URL (用于分片上传、图片处理等功能)
# [Vercel] 前端调用 Worker API 的 URL
NEXT_PUBLIC_WORKER_URL=http://localhost:3001
# [Worker] Worker 服务自身监听的 URL（可选，主要用于日志）
WORKER_URL=http://localhost:3001

# Worker API Key (用于 Worker API 认证，必须配置)
# 重要: 生产环境必须设置强密码，防止未授权访问
# 
# 生成方式（选择一个）:
#   1. openssl rand -hex 32
#   2. node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
#   3. 使用在线密码生成器（至少 32 字符）
#
# 注意: 
#   - 不要使用示例值 "your-secret-api-key-change-this-in-production"
#   - 必须生成自己的唯一密钥（至少 32 字符）
#   - 开发环境可以不设置（会有警告），生产环境必须设置
#   - 不要提交到 Git（确保 .env.local 在 .gitignore 中）
# [Both] Vercel 和 Worker 服务都需要配置相同的值
WORKER_API_KEY=your-secret-api-key-change-this-in-production

# 图片处理标准配置（可选，默认值向后兼容）
# 预览图最大尺寸（像素），默认 1920px
# 注意：修改此值后，已上传的图片不会自动重新生成预览图
# 如需更新旧图片，请使用批量重新生成功能
# [Worker] 仅在 Worker 服务中配置
# PREVIEW_MAX_SIZE=1920

# 缩略图最大尺寸（像素），默认 400px
# 推荐值：250px（平衡文件大小和显示质量）
# [Worker] 仅在 Worker 服务中配置
# THUMB_MAX_SIZE=250

# ==================== Redis ====================
# Redis 配置（用于 Worker 队列和速率限制）
# 本地开发使用本地 Redis
# [Worker] Worker 服务连接 Redis（用于队列和缓存）
REDIS_HOST=localhost
REDIS_PORT=6379
# [Worker] Redis 密码（如果设置了）
# REDIS_PASSWORD=your-redis-password

# Upstash Redis 配置（可选，用于生产环境分布式速率限制）
# 获取方式: https://console.upstash.com/ -> Create Database
# 注意: 如果配置了 UPSTASH_REDIS_REST_URL 和 UPSTASH_REDIS_REST_TOKEN，
#       速率限制将自动使用 Redis 存储（支持多服务器部署）
# [Vercel] Vercel 服务端 API Routes 使用（用于速率限制）
# UPSTASH_REDIS_REST_URL=https://your-redis.upstash.io
# UPSTASH_REDIS_REST_TOKEN=your-redis-token

# ==================== 应用配置 ====================
# [Vercel] 应用访问地址（生产域名，用于生成分享链接等）
NEXT_PUBLIC_APP_URL=http://localhost:3000

# Photographer/Studio Branding
# [Vercel] 前端显示的品牌信息
NEXT_PUBLIC_PHOTOGRAPHER_NAME=PIS Photography
NEXT_PUBLIC_PHOTOGRAPHER_TAGLINE=专业活动摄影
# 自定义 Logo URL (可选，默认使用 /icons/icon.svg)
# [Vercel] 前端显示的自定义 Logo
# NEXT_PUBLIC_LOGO_URL=/icons/your-logo.svg

# ==================== Cloudflare Turnstile (可选) ====================
# 用于登录页面的机器人验证（Invisible 模式，用户无感知）
# 获取方式: https://dash.cloudflare.com/ -> Turnstile -> Add Site
# 注意: 如果不配置，登录功能仍然正常工作（降级策略）
# [Vercel] 前端使用站点密钥
# NEXT_PUBLIC_TURNSTILE_SITE_KEY=your-site-key
# [Vercel] 服务端验证使用密钥（敏感信息，不要设置为 NEXT_PUBLIC_*）
# TURNSTILE_SECRET_KEY=your-secret-key

# ==================== Cloudflare CDN 缓存清除 (可选) ====================
# 用于在删除照片时清除 CDN 缓存，确保删除后无法通过 CDN 访问
# 获取方式:
# 1. API Token: https://dash.cloudflare.com/ -> My Profile -> API Tokens -> Create Token
#    权限: Zone -> Cache Purge -> Purge
# 2. Zone ID: https://dash.cloudflare.com/ -> 选择域名 -> 右侧边栏找到 Zone ID
# 
# 注意: 需要在 Vercel 和 Worker 服务中都配置这些环境变量
# 
# [Vercel] Cloudflare API Token（敏感信息，不要设置为 NEXT_PUBLIC_*）
# CLOUDFLARE_API_TOKEN=your-api-token
# [Vercel] Cloudflare Zone ID
# CLOUDFLARE_ZONE_ID=your-zone-id
# [Vercel] 媒体服务器域名（可选，用于验证）
# CLOUDFLARE_MEDIA_DOMAIN=media.yourdomain.com
# 
# [Worker] Worker 服务也需要配置相同的 Cloudflare API Token 和 Zone ID
# （用于在自动清理已删除照片时清除 CDN 缓存）
# Worker 服务会从环境变量中读取 CLOUDFLARE_API_TOKEN 和 CLOUDFLARE_ZONE_ID
